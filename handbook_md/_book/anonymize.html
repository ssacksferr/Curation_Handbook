<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UNHCR Microdata Curation Handbook - 2023 - 4&nbsp; Anonymize</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./drr.html" rel="next">
<link href="./indentify_data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Anonymize</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">UNHCR Microdata Curation Handbook - 2023</a> 
        <div class="sidebar-tools-main">
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./UNHCR-Microdata-Curation-Handbook---2023.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./UNHCR-Microdata-Curation-Handbook---2023.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">About the handbook</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Getting Started</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./indentify_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Identify data for publication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Anonymization</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anonymize.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Anonymize</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./drr.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Disclosure risk assessment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Publication of data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Validation and authorization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./publication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Publication on the MDL and other post-curation tasks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./annex1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Annex: R Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./annex2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Annex - Metadata guidance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./annex3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Annex: Key and sensitive variables</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-5datacheck" id="toc-sec-5datacheck" class="nav-link active" data-scroll-target="#sec-5datacheck"><span class="toc-section-number">4.1</span>  Data check and preparation</a>
  <ul class="collapse">
  <li><a href="#sec-5varnamesandlabs" id="toc-sec-5varnamesandlabs" class="nav-link" data-scroll-target="#sec-5varnamesandlabs"><span class="toc-section-number">4.1.1</span>  Variable names and labels</a></li>
  <li><a href="#sec-5varorder" id="toc-sec-5varorder" class="nav-link" data-scroll-target="#sec-5varorder"><span class="toc-section-number">4.1.2</span>  Variable order</a></li>
  <li><a href="#sec-5vartypes" id="toc-sec-5vartypes" class="nav-link" data-scroll-target="#sec-5vartypes"><span class="toc-section-number">4.1.3</span>  Variable types</a></li>
  <li><a href="#sec-5completeness" id="toc-sec-5completeness" class="nav-link" data-scroll-target="#sec-5completeness"><span class="toc-section-number">4.1.4</span>  Data completeness</a></li>
  <li><a href="#sec-5duplicates" id="toc-sec-5duplicates" class="nav-link" data-scroll-target="#sec-5duplicates"><span class="toc-section-number">4.1.5</span>  Duplicate records</a></li>
  <li><a href="#sec-5missing" id="toc-sec-5missing" class="nav-link" data-scroll-target="#sec-5missing"><span class="toc-section-number">4.1.6</span>  Missing values</a></li>
  <li><a href="#sec-5spaces" id="toc-sec-5spaces" class="nav-link" data-scroll-target="#sec-5spaces"><span class="toc-section-number">4.1.7</span>  Excess spacing in string values</a></li>
  <li><a href="#sec-5consistent" id="toc-sec-5consistent" class="nav-link" data-scroll-target="#sec-5consistent"><span class="toc-section-number">4.1.8</span>  Consistent responses</a></li>
  <li><a href="#sec-5relationship" id="toc-sec-5relationship" class="nav-link" data-scroll-target="#sec-5relationship"><span class="toc-section-number">4.1.9</span>  Consistent variable relationships</a></li>
  <li><a href="#sec-5outliers" id="toc-sec-5outliers" class="nav-link" data-scroll-target="#sec-5outliers"><span class="toc-section-number">4.1.10</span>  Outliers</a></li>
  <li><a href="#sec-5constreport" id="toc-sec-5constreport" class="nav-link" data-scroll-target="#sec-5constreport"><span class="toc-section-number">4.1.11</span>  Consistency primary analysis / report</a></li>
  <li><a href="#sec-5consent" id="toc-sec-5consent" class="nav-link" data-scroll-target="#sec-5consent"><span class="toc-section-number">4.1.12</span>  Consent</a></li>
  <li><a href="#sec-5id" id="toc-sec-5id" class="nav-link" data-scroll-target="#sec-5id"><span class="toc-section-number">4.1.13</span>  Unique ID</a></li>
  <li><a href="#sec-5weights" id="toc-sec-5weights" class="nav-link" data-scroll-target="#sec-5weights"><span class="toc-section-number">4.1.14</span>  Prepare weights</a></li>
  <li><a href="#sec-5saveclean" id="toc-sec-5saveclean" class="nav-link" data-scroll-target="#sec-5saveclean"><span class="toc-section-number">4.1.15</span>  Save clean version and cleaning script</a></li>
  </ul></li>
  <li><a href="#sec-5anon" id="toc-sec-5anon" class="nav-link" data-scroll-target="#sec-5anon"><span class="toc-section-number">4.2</span>  Anonymization</a>
  <ul class="collapse">
  <li><a href="#sec-5newanondat" id="toc-sec-5newanondat" class="nav-link" data-scroll-target="#sec-5newanondat"><span class="toc-section-number">4.2.1</span>  Create new dataframe</a></li>
  <li><a href="#sec-5removeanon" id="toc-sec-5removeanon" class="nav-link" data-scroll-target="#sec-5removeanon"><span class="toc-section-number">4.2.2</span>  Remove variables that will not be published</a></li>
  <li><a href="#sec-5sample" id="toc-sec-5sample" class="nav-link" data-scroll-target="#sec-5sample"><span class="toc-section-number">4.2.3</span>  Prepare sample (if relevant)</a></li>
  <li><a href="#sec-5assessrisk" id="toc-sec-5assessrisk" class="nav-link" data-scroll-target="#sec-5assessrisk"><span class="toc-section-number">4.2.4</span>  Assess risk</a></li>
  <li><a href="#sec-5reducerisk" id="toc-sec-5reducerisk" class="nav-link" data-scroll-target="#sec-5reducerisk"><span class="toc-section-number">4.2.5</span>  Reduce risk</a></li>
  <li><a href="#sec-5assessutility" id="toc-sec-5assessutility" class="nav-link" data-scroll-target="#sec-5assessutility"><span class="toc-section-number">4.2.6</span>  Assess utility and utility loss</a></li>
  <li><a href="#sec-5saveanon" id="toc-sec-5saveanon" class="nav-link" data-scroll-target="#sec-5saveanon"><span class="toc-section-number">4.2.7</span>  Save anonymous version, codebook and anonymization script</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-5anonymize" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Anonymize</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>If the microdata is relevant for publication on the MDL, the Data Curator can start the anonymization process. This firstly involves data checking and preparation followed by the anonymization. This section provides general guidance on the anonymization process, with cross-cutting examples. Additional guidance complementary to this section that covers specific issues for several standard or semi-standard data collection exercises and surveys is covered in Annex – Further guidance on anonymization.</p>
<p>&nbsp;</p>
<section id="sec-5datacheck" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-5datacheck"><span class="header-section-number">4.1</span> Data check and preparation</h2>
<p>The objective of the data check and preparation is to identify any issues in a dataset (errors and inconsistencies across variables, data incompleteness, etc.) and ensure that:</p>
<ul>
<li><p>the statistics shared in public reports are reproducible; and</p></li>
<li><p>the dataset is ready for re-use by other software packages and users (i.e.&nbsp;variable names and labels are logical, data is in a standard and reusable format, etc.)</p></li>
</ul>
<p>A few points to note:</p>
<ul>
<li><p>Ideally any issues in a dataset should have been addressed by the Data Provider as part of the primary data processing and use, and the data shared on RIDL is a clean version. Nonetheless, often the only data available on RIDL is the raw version and/or the clean version may still have some issues that need to be addressed before the data is anonymized and published on the MDL.</p></li>
<li><p>This step may reveal quality issues that would require a reconsideration of the relevance of the publication of the anonymous version of the dataset and/or put into question the results of an already published report or analytical piece. If this is the case, the Data Curator must present their concerns to the Data Provider.</p></li>
<li><p>Data Curators should take a conservative approach and any issue should be fixed only if necessary and only after discussing it with all the Data Providers and receiving their approval.</p></li>
<li><p>If that dataset requires any cleaning, it must be documented, preferably in a R script or other software package, to ensure the replicability of the results. A copy of the raw data (e.g.&nbsp;0.1) or previous versions of the clean data prior to further cleaning (e.g.&nbsp;1.1) shared on RIDL should always be preserved.</p></li>
<li><p>This section focuses on the most common issues found in personal microdata of PoCs collected by UNHCR and its partners, however every dataset has its own particularities and may require additional checks.</p></li>
</ul>
<p><strong>Data check and preparation checklist</strong></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="">Check variable names and labels</p></li>
<li><p><input type="checkbox" disabled="">Check value name and labels</p></li>
<li><p><input type="checkbox" disabled="">Check variable order</p></li>
<li><p><input type="checkbox" disabled="">Check variable types</p></li>
<li><p><input type="checkbox" disabled="">Check data completeness</p></li>
<li><p><input type="checkbox" disabled="">Check for duplicate records</p></li>
<li><p><input type="checkbox" disabled="">Check for missing values</p></li>
<li><p><input type="checkbox" disabled="">Check for excess spacing in string values</p></li>
<li><p><input type="checkbox" disabled="">Check for consistent responses</p></li>
<li><p><input type="checkbox" disabled="">Check for consistent variable relationships</p></li>
<li><p><input type="checkbox" disabled="">Check for outliers</p></li>
<li><p><input type="checkbox" disabled="">Check consistency with primary analysis / report</p></li>
<li><p><input type="checkbox" disabled="">Check consent variable</p></li>
<li><p><input type="checkbox" disabled="">Check and prepare unique ID</p></li>
<li><p><input type="checkbox" disabled="">Save clean version and cleaning script</p></li>
<li><p><input type="checkbox" disabled="">Remove variables that will not be released</p></li>
<li><p><input type="checkbox" disabled="">Prepare sample (if relevant)</p></li>
<li><p><input type="checkbox" disabled="">Prepare weights</p></li>
</ul>
<p>&nbsp;</p>
<section id="sec-5varnamesandlabs" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="sec-5varnamesandlabs"><span class="header-section-number">4.1.1</span> Variable names and labels</h3>
<p>Variable names (or codes) are the short names used by a software to refer to or call a variable, whereas variable labels are a description of the variable, reflecting the question used in a questionnaire or instructions in a data collection form. At the very least, variable names and labels must be easily interpreted and follow the same style throughout the data. If standards or codebooks are not available from the Data Provider or within UNHCR and/or are not consistent or easily interpreted, the Humanitarian Exchange Language (HXL) should serve as a guide together with the general instructions below.)</p>
<p>The following table highlights how names and variable labels are referred to in R, Stata and Kobo, and any limitations.</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 38%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Software</th>
<th>Variable name</th>
<th></th>
<th>Variable label</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><em>How it is called in the software</em></td>
<td><em>Limitations</em></td>
<td><em>How it is called in the software</em></td>
<td><em>limitations</em></td>
</tr>
<tr class="even">
<td><strong>R</strong></td>
<td>name</td>
<td>No spaces</td>
<td>label</td>
<td>None</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>Will run into issues if use special characters such as @ or start name with an underscore (_) or number</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>Cannot use words reserved for functions</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Stata</strong></td>
<td>name</td>
<td>No spaces</td>
<td>label</td>
<td>80-character limit</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>32 characters</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>First character must be a letter or one of the characters @, #, or $</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>Cannot use words reserved for functions</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>KoBo</strong></td>
<td>Data Column Name in form creator</td>
<td>No spaces</td>
<td>Question in form creator</td>
<td>No restrictions</td>
</tr>
<tr class="even">
<td></td>
<td>XML values in data download</td>
<td>No limit on # of characters</td>
<td>Label in data download</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>Only letters, numbers, and underscores are allowed</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>Must start with a letter or an underscore</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<section id="sec-5varnames" class="level4" data-number="4.1.1.1">
<h4 data-number="4.1.1.1" class="anchored" data-anchor-id="sec-5varnames"><span class="header-section-number">4.1.1.1</span> Variable names</h4>
<p>Variable names should be concise, easy-to-read and, where possible, follow standards established or followed by UNHCR and its partners. In general, the following rules should be applied:</p>
<ul>
<li><p>Variable names should be no longer than 32 characters.</p></li>
<li><p>Variable names should only include standard English letters (a,b,c…z), numbers (0,1,…9) and underscore (_).&nbsp;</p></li>
<li><p>Variable names should not include special alphabet letters (æ, ñ, é, etc.), forward/back slashes (/,), periods (.) or any other special characters ($, ’’, *, @, etc.) or spaces.</p></li>
<li><p>Variable names should always start with a letter. Do not start a name with a number or an underscore.</p></li>
<li><p>Variable names should be in lowercase when possible</p></li>
</ul>
<p>While there is no style to follow strictly, once you choose a style you should stick with it for all the variables in the dataset. Common styles are underscore (_) separate words (for example: <code>your_variable_name</code>) or camel case (for example: <code>yourVariableName</code>). Underscore separated lowercase words is the preferred style.</p>
<p>If variable names refer to the questions of a survey, they should reflect the structure of the questionnaire. For example, question 4 of section 7 could be named as <code>S07_04</code>. If there are several alternatives in said question and each one is represented in a different column of the dataset, they could be named ordinally as <code>S07_04_a</code>.</p>
<p>If the same variable appears in multiple data files, it should have the same name (for example, the household ID may be present in both the household level file and the individual level file). On the other hand, if a variable is named equally across more than one data file but it refers to different information, one of them should be renamed</p>
<p>If the same variable name appears in the same data file more than once, one of the variables should be renamed. &nbsp;</p>
<p><em>Renaming variables in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Given the dataset your_dataset – we will use this name in all examples -, you can print the variable names with the following command:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print on console all variable names </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#You can rename all variable names with the following command (please note that you must provide a name for all the variables): </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of converting the names in a data frame with 4 variables </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"new_var_name1"</span>, <span class="st">"new_var_name2"</span>, <span class="st">"new_var_name3"</span>, <span class="st">"new_var_name4"</span>) </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#If you just need to modify the name of one or few variables, the following code may be used:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the name of one variable</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset) [<span class="fu">names</span>(your_dataset) <span class="sc">==</span> <span class="st">"old_var_name"</span>] <span class="ot">&lt;-</span> <span class="st">"new_var_name"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#And alternatively, you can use the dplyr package: </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename specific columns </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">rename</span>(your_dataset, <span class="at">new_var_name1 =</span> old_var_name1,  <span class="at">new_var_name3 =</span> old_var_name3) </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Several other issues in the data can be easily and efficiently managed in R such as converting all variables to lowercase, replacing characters in variable names and trimming variable length. Example codes below:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all variable names to lowercase</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">names</span>(your_dataset))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Change forward slashes in variable names to underscores</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x =</span> <span class="fu">names</span>(your_dataset), <span class="at">pattern =</span> <span class="st">"/"</span>, <span class="at">replacement =</span> <span class="st">"_"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit number of characters to &lt;32. Pay attention b/c it may make two or more variables have the same variable name!!!</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(your_dataset) <span class="ot">&lt;-</span> <span class="fu">strtrim</span>(<span class="fu">names</span>(your_dataset), <span class="dv">31</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#The clean_names function in the janitor package is also a useful tool to clean names, with a number of options. Read more about it here: https://www.rdocumentation.org/packages/janitor/versions/1.2.0/topics/clean_names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exporting variable names from Kobo</strong></p>
<p>Variables in Kobo have labels (i.e., the question asked in the form) and XML values (i.e., name of the variable). While by default data downloaded from Kobo uses the complete questionnaire questions as column headers, data uploaded to RIDL should have the XML values from Kobo as variable name. To do this:</p>
<p>1. Set the “Value and header format’ to ‘XML values and headers’ when downloading data from Kobo. See screenshot below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\section4_1_1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>2. Ensure the RIDL record contains the Kobo form, which serves as both the questionnaire and data dictionary with the labels and names (XML values).</p>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5varorder" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="sec-5varorder"><span class="header-section-number">4.1.2</span> Variable order</h3>
<p>The order in which variables (columns) appear in a data should be sensible and meaningful. Typically, unique IDs should come first, and other variables should appear in an order that makes it simple to understand the&nbsp;structure of the dataset. If the data was gathered through a survey, the variables order should reflect the questionnaire structure.&nbsp;</p>
<p><em>Changing variable order in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using dplyr: specify the variable to move </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>variable_name <span class="ot">&lt;-</span> <span class="st">"your_variable_name"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Move as first variable of the dataset </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">select</span>(your_dataset, variable_name, <span class="fu">everything</span>())</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Move as last variable of the dataset </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">select</span>(your_dataset, <span class="sc">-</span> variable_name, <span class="fu">everything</span>()) </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the variable to the third position</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>new_variable_position <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">select</span>(your_dataset, <span class="dv">1</span> <span class="sc">:</span> new_variable_position, variable_name, <span class="fu">everything</span>()) </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Move var_y after var_x using tidyr</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="st">"var_y"</span>, <span class="at">.after =</span> <span class="st">"var_x"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Move var_y before var_x</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="st">"var_y"</span>, <span class="at">.before =</span> <span class="st">"var_x"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternatively, you can specify the exact order of all the variables with the following code. In this case you must list out all the variables in the dataset.</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Write ALL the variables" names in the desired order </span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># in this simple example, the dataset has only 3 variables </span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>new_variable_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"var_x"</span>, <span class="st">"var_y"</span>, <span class="st">"var_z"</span>) </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the dataset with the new order </span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[ , new_variable_order] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5vartypes" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="sec-5vartypes"><span class="header-section-number">4.1.3</span> Variable types</h3>
<section id="sec-5varclasses" class="level4" data-number="4.1.3.1">
<h4 data-number="4.1.3.1" class="anchored" data-anchor-id="sec-5varclasses"><span class="header-section-number">4.1.3.1</span> Variable type</h4>
<p>Depending on the software application used to collect and store the data, different types of data may be treated as different variable types. For example, when exporting data to an Excel file from Kobo Toolbox, numbers are often treated as text and as such will be considered characters when brought into R. Depending on the usage of the variable, it may need to be converted before performing a given operation. For example, you cannot use the ‘summary’ command on a variable of type character, it needs to first be converted to numeric.</p>
<p>The following is a list of the most common variable types or classes in R<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<ul>
<li><p>Numeric – numbers and decimals</p></li>
<li><p>Integer – numeric data without decimals</p></li>
<li><p>Character – text or string</p></li>
<li><p>Factor –Integer values/levels with an associated string which is read as a label</p></li>
<li><p>Logical/boolean – Variable with values TRUE/FALSE</p></li>
</ul>
<p><strong>Note</strong> If you import a dataset into R, and all the variables are treated as characters (for example), it is not necessary to convert every single variable into their correct format in preparing the clean or anonymized version of the data. Focus on the variables that need to be in the correct format for any manipulation you need to do. For example, if you need to examine a numeric variable, it should be of numeric type. If a variable will be a key variable in <code>sdcMicro</code>, it needs to be of type factor (more on that in the next chapter).</p>
<p><em>Checking and converting variable formats in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the variable format</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#You can convert the format using the as.character, as.factor, as.numeric and as.integer commands. Below is an example to convert to numeric. The code is the same for the other commands.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert a single variable to numeric</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert a range of variables from your_variable_r to your_variable_y to numeric</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>dat_clean <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat_clean, <span class="fu">across</span>(your_variable_r<span class="sc">:</span>your_variable_y, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5multvar" class="level4" data-number="4.1.3.2">
<h4 data-number="4.1.3.2" class="anchored" data-anchor-id="sec-5multvar"><span class="header-section-number">4.1.3.2</span> Multiple choice variables</h4>
<p>Some data collection tools, including KoBo Toolbox, include both the short and wide form of a multiple-choice question with multiple select options. For example, the dataset will have one variable with a list of all the responses that the respondent selected, and a binary variable associated with each response option (1 if the response was selected and 0 if it was not). In these cases, both forms of the variable may be preserved in the dataset as each will suit different needs of the users. Special attention must be made in cases where these multiple-choice variables are key variables. Any manipulations to one form of the variable as part of the anonymization process should be reflected on the other form or the other form should be removed.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5freetext" class="level4" data-number="4.1.3.3">
<h4 data-number="4.1.3.3" class="anchored" data-anchor-id="sec-5freetext"><span class="header-section-number">4.1.3.3</span> Free text variables</h4>
<p>Free text variables are unstructured responses to open-ended questions or requests to specify a response to ‘<code>other</code>’ category in multiple choice questions. These variables need to be reviewed because they can be prone to errors or contain sensitive or identifying information.</p>
<p>In general:</p>
<ul>
<li><p>Free text variables with direct identifiers should be removed from clean version of datasets that are not meant to have direct identifiers.</p></li>
<li><p>Free text variables should be removed from anonymous versions of datasets that will be published on the MDL unless the Data Provider requests to keep the free text variables (i.e .because they would be useful to research and do not pose any additional disclosure risk).</p></li>
</ul>
<p>&nbsp;</p>
</section>
<section id="sec-5freemultiple" class="level4" data-number="4.1.3.4">
<h4 data-number="4.1.3.4" class="anchored" data-anchor-id="sec-5freemultiple"><span class="header-section-number">4.1.3.4</span> Free text responses to other in a multiple-choice question</h4>
<p>Responses to specify other in a multiple-choice question should be checked to make sure that the response category does not already exist. Consider the example where a respondent is asked how they spent the cash they received from UNHCR and they were provided with the options: food, rent, clothing, utilities, education, livelihood inputs and other. A respondent responded ‘other’ and when asked to specify what other items they spent they money on, the response was ‘rice’. In this example, the response should have been coded as ‘food’.</p>
<p>These issues need to be shared with the Data Provider, and the best step for dealing with them determined jointly between the Data Provider and the Data Curator. If it is decided to recode the categories, the following code can be used.</p>
<p><em>Cleaning up free text responses in other category to multiple choice variables that have existing category</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode existing category</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>spent_cash_on_food[your_dataset<span class="sc">$</span>spent_cash_on_other_specify<span class="sc">==</span><span class="st">"Rice"</span>] <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace response to other as 0</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>spent_cash_on_other[your_dataset<span class="sc">$</span>spent_cash_on_other_specify<span class="sc">==</span><span class="st">"Rice"</span>] <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove free text specifying other</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>spent_cash_on_other_specify[your_dataset<span class="sc">$</span>spent_cash_on_other_specify<span class="sc">==</span><span class="st">"Rice"</span><span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Recoding several "other" categories to existing category</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>main_category <span class="ot">&lt;-</span> <span class="fu">if_else</span>(your_dataset<span class="sc">$</span>other_category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"main_category_with_space"</span>, <span class="st">"main_category_with_typo"</span>),  <span class="st">"main_category"</span>, your_dataset<span class="sc">$</span>main_category)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For example:</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>roof_type <span class="ot">&lt;-</span> <span class="fu">if_else</span>(your_dataset<span class="sc">$</span>roof_type_other <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tarpaulin "</span>, <span class="st">"Tarpaulin"</span>, <span class="st">"tapuline"</span>),  <span class="st">"tarpaulin"</span>, your_dataset<span class="sc">$</span>roof_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5date" class="level4" data-number="4.1.3.5">
<h4 data-number="4.1.3.5" class="anchored" data-anchor-id="sec-5date"><span class="header-section-number">4.1.3.5</span> Date and time</h4>
<p>Date and time formats should be consistent with each other, never use different formats in the same dataset.&nbsp;&nbsp;For maximum compatibility, formats should adhere to the standard ISO 8601<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> or dd-mm-YYYY (i.e.&nbsp;7<sup>th</sup> of May of 2021 should be written as 07-05-2021) or YYYY-mm-dd which is the standard for some R packages (see below). In either case, the year should always be four digits and not abbreviated into two.</p>
<p><em>Formatting dates in R</em></p>
<p>First, you need to identify the format in which your dates are provided. You can edit the format parameter with the <code>as.Date</code> command (in base R) with the codes in the table below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_1_3_5.png" class="img-fluid figure-img" width="263"></p>
</figure>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert from character to date format using as.Dates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"May 27 1984"</span>, <span class="st">"July 7 2005"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(your_dataset<span class="sc">$</span>dates, <span class="at">format =</span> <span class="st">"%B %d %Y"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: [1] "1984-05-27" "2005-07-07"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the lubridate package, dates can be easily converted to date format with the following convention YYYY-mm-dd</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert date from character to date format when the original date is stored as a character in YYYY-mm-dd.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(your_dataset<span class="sc">$</span>date)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert date from character to date format when the original date is stored as a character in mm-dd-YYYY</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">mdy</span>(your_dataset<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5completeness" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="sec-5completeness"><span class="header-section-number">4.1.4</span> Data completeness</h3>
<p>Ensure that there are no gaps or missing information in the data that can be avoided. This will include checking the number of observations against what is reported by the Data Provider and/or in the report as well as comparing the variables in the dataset against the questionnaire or data collection form to make sure that all the expected data is included. Sometimes datasets will include blank records (rows) or variables (columns). These can be removed if they are not meaningful (e.g.&nbsp;system generated variables or kobo metadata, erroneous blank records). They do not need to be removed if they are associated with a real record or variable.</p>
<p><em>Removing records (rows) and variables (columns) with all missing values in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove blank records</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[ <span class="fu">rowSums</span>(<span class="fu">is.na</span>(your_dataset)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(your_dataset) ,]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#You may also want to remove variables (columns) that have no responses or are blank. </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove blank variables</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[ <span class="fu">colSums</span>(<span class="fu">is.na</span>(your_dataset)) <span class="sc">&lt;</span> <span class="fu">nrow</span>(your_dataset) ,]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># remove blank records using the janitor package</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">remove_empty</span>(<span class="at">which=</span><span class="st">"rows"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># remove blank variables</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">remove_empty</span>(<span class="at">which=</span><span class="st">"cols"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5duplicates" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="sec-5duplicates"><span class="header-section-number">4.1.5</span> Duplicate records</h3>
<p>Datasets should not include any duplicate records. The simplest way to look for duplicates in a dataset is to identify the variable (e.g.&nbsp;unique ID) or combination of variables (e.g.&nbsp;name, age, sex, geographic location) that must be unique to each observation and then verify that there are no observations sharing the same values.</p>
<p><em>Looking for duplicates in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Given the dataset your_dataset, you can remove duplicates based of a single variable using the following code:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>your_dataset[<span class="sc">!</span><span class="fu">duplicated</span>(your_dataset<span class="sc">$</span>your_variable), ]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#using dplyr:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">distinct</span>(your_variable,<span class="at">keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#More elaborate step-by-step guide to find duplicates in your_dataset:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame with list of IDs and the number of times they occurred</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>n_occur <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(your_dataset<span class="sc">$</span>id))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify which IDs occurred more than once</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>n_occur[n_occur<span class="sc">$</span>Freq <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the list of IDs that occurred more than once</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>your_dataset[your_dataset<span class="sc">$</span>id <span class="sc">%in%</span> n_occur<span class="sc">$</span>Var1[n_occur<span class="sc">$</span>Freq <span class="sc">&gt;</span> <span class="dv">1</span>],]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#To check for duplicates using a combination of variables, first create a unique variable based off of those variables and then use the same codes as above to check for duplicates.</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable (combo_var) that combines multiple variables</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>combo_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">as.character</span>(your_dataset<span class="sc">$</span>var_x),<span class="st">"_"</span>, <span class="fu">as.character</span>(your_dataset<span class="sc">$</span>var_y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5missing" class="level3" data-number="4.1.6">
<h3 data-number="4.1.6" class="anchored" data-anchor-id="sec-5missing"><span class="header-section-number">4.1.6</span> Missing values</h3>
<p>Datasets and variables will often contain missing (or blank) values for several different reasons. It should be clear what exactly these values mean. For example, do they indicate that the question is non-applicable, is it a non-response, a true missing value or a value of 0<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. If it is not clear, the Data Provider should be consulted to clarify the meaning of the missing or blank values.</p>
<p>Working with missing values can be a bit tricky depending on how they appear in the dataset. Often, missing values are left blank, and R treats them as <code>NA</code>. Other times they may have specific codes defined during data collection (i.e.&nbsp;-9999, 9999, etc.). This should be recoded to missing as to ensure summary statistics are not being affected by the codification of these values.</p>
<p><em>Dealing with missing values in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#How data can be imported in R converting blank values to NA and replacing 0 and 9999 values with NA in cases they were incorrectly coded.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data from a csv file encoded in UTF-8. The values specified in na.strings will be set automatically as missing values for all variables</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"your_dataset_file_name.csv"</span>, <span class="at">na.strings=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"NA"</span>), <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace all 0 and 9999 values with NA in cases they were incorrectly coded</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable <span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable <span class="sc">==</span><span class="dv">9999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that R does not always show NAs in a frequency table. To force R to show the NAs, adapt the code as follows. Given your_dataset and your_variable:</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency table without NAs</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency table with NAs</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>your_variable, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Finally, to export data replacing the NA with blank values, the following code can be used.</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dataset as csv file, setting missing values to blank values</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(your_dataset, <span class="st">"your_dataset_file_name_new.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na=</span><span class="st">""</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The proportion of allowed missing values (not to be confused with non-applicable, which is not a missing value) will depend on the impact on data quality and is something that is determined by the Data Curator in consultation with the Data Provider.</p>
<p><em>Check for missing values in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>You can perform common checks on missing values with the following code<span class="sc">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total proportion of missing observations in the dataset </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">is.na</span>(your_dataset)) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the proportions of missing observations for each variable in the dataset and show them in decreasing order </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">colMeans</span>(<span class="fu">is.na</span>(your_dataset)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>) </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create crosstab of two variables to see how missing values are distributed </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>your_variable1, your_dataset<span class="sc">$</span>your_variable2, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete variables with all NAs</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">=</span>your_dataset[,<span class="fu">colSums</span>(<span class="fu">is.na</span>(your_dataset)) <span class="sc">&lt;</span><span class="fu">nrow</span>(your_dataset)] </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the proportion of missing observations and create a chart showing most common missing value patterns using the VIM package</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aggr</span>(your_dataset, <span class="at">sortVar=</span><span class="cn">TRUE</span>))<span class="sc">$</span>combinations</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Finally the naniar package can be useful to visualize missing values. Read more here: https://www.rdocumentation.org/packages/naniar/versions/0.6.1 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5spaces" class="level3" data-number="4.1.7">
<h3 data-number="4.1.7" class="anchored" data-anchor-id="sec-5spaces"><span class="header-section-number">4.1.7</span> Excess spacing in string values</h3>
<p>String values should never start or end with a space or contain repeated spaces. This issue may be difficult to spot since empty spaces are invisible, but they cause problems during analysis since they are recognized by statistical software. For example, “<code>your string</code>” and ‘<code>your  string</code>’ may look the same when visually exploring the dataset, but when you create cross tabulations for example, they are different.&nbsp;It may be useful to check this early on because it can assist when checking consistent responses, for example.</p>
<p>The different possible cases are:&nbsp;</p>
<ul>
<li><p>Leading space: ‘<code>your string</code>’&nbsp;</p></li>
<li><p>Trailing space: ‘<code>your string</code>’&nbsp;</p></li>
<li><p>Repeated space between words: ‘<code>your&nbsp;&nbsp;&nbsp; string</code>’&nbsp;</p></li>
<li><p>Any combination of the above: ‘<code>your&nbsp;&nbsp;&nbsp; string</code>’&nbsp;</p></li>
</ul>
<p>Most softwares have a trimming function to quickly remove trailing, leading&nbsp;and repeated spaces.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The package stringr provides a function called str_squish to trim all spaces in a string. </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># trim all the values in a variable</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">str_squish</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#The package janitor provides a function to remove all trailing spaces in variable names:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(your_dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5consistent" class="level3" data-number="4.1.8">
<h3 data-number="4.1.8" class="anchored" data-anchor-id="sec-5consistent"><span class="header-section-number">4.1.8</span> Consistent responses</h3>
<p>Checks should be done on the consistency in responses to key variables, other variables of interest to the Data Users, and/or any variables that the Data Provider advised should be checked. In some cases, inconsistencies may not be discovered until detailed analysis is performed, and the outputs seem ‘off’. In any case, the Data Curator should always take a step back and look at the dataset large to see if any obvious issues can at least be spotted. Below are some common examples.</p>
<p>&nbsp;</p>
<section id="sec-5categories" class="level4" data-number="4.1.8.1">
<h4 data-number="4.1.8.1" class="anchored" data-anchor-id="sec-5categories"><span class="header-section-number">4.1.8.1</span> Inconsistent data categories</h4>
<p>Data category inconsistencies occur when a variable has two or more distinct values representing the same category.&nbsp;This can be caused by synonymous words, typos, formatting, etc. This includes ensuring that, for example, responses to multiple choice questions fall into one of the valid answer options in the questionnaire or data collection form.&nbsp;</p>
<p>The following table highlights an example of inconsistent use of country names, Swaziland and Eswatini refer to the same country as does Côte d’Ivoire and Ivory Coast</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">country_origin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">Swaziland</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">Côte d’Ivoire</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">Eswatini</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Ivory Coast</td>
</tr>
</tbody>
</table>
<p><em>Check for variable inconsistencies in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#You can identify inconsistencies and fix them with the following code:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print all existing values for the variable to spot any issue </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(your_dataset<span class="sc">$</span>your_variable)), <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a frequency table to see how many records fall in each category</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#If necessary, replace the values</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable <span class="sc">==</span><span class="st">"Ivory Coast"</span>] <span class="ot">&lt;-</span> <span class="st">"Côte d'Ivoire"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable <span class="sc">==</span><span class="st">"Swaziland"</span>] <span class="ot">&lt;-</span> <span class="st">"Eswatini"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5capitals" class="level4" data-number="4.1.8.2">
<h4 data-number="4.1.8.2" class="anchored" data-anchor-id="sec-5capitals"><span class="header-section-number">4.1.8.2</span> Consistent use of capitalization in string values</h4>
<p>Most statistical software applications are case sensitive, meaning they consider differently two strings with different capitalization. See the example frequency table below where <code>Bas Sassandra</code> is repeated because one of the spellings has lowercase for the second word in the name of the district.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 2
  province      population
  &lt;chr&gt;              &lt;dbl&gt;
1 Abidjan               70
2 Bas sassandra          2
3 Bas Sassandra          7
4 Cavally                4
5 Guemon                 1
6 Tonkpi                 7</code></pre>
</div>
</div>
<p><em>Check and fix inconsistent capitalization in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Consider the dataset your_dataset and the variable your_variable. A simple way to observe inconsistencies in value labels is to view a table of the responses in the variable.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a frequency table</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace error with simple find and replace  </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>your_dataset[your_dataset<span class="sc">$</span>your_variable<span class="sc">==</span><span class="st">"your response"</span>] <span class="ot">&lt;-</span> <span class="st">"Your Response"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternatively, you can capitalize all values of a variable in the same manner. This is particularly useful if there are many values to fix.</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Change all to UPPER CASE</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">toupper</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Change all to lower case</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">tolower</span>(your_dataset<span class="sc">$</span>your_variable)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Change all to Title Case</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">toTitleCase</span>(<span class="fu">tolower</span>(your_dataset<span class="sc">$</span>your_variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5align" class="level4" data-number="4.1.8.3">
<h4 data-number="4.1.8.3" class="anchored" data-anchor-id="sec-5align"><span class="header-section-number">4.1.8.3</span> Data table alignment</h4>
<p>Another cause for inconsistencies is a data entry mistake where variable values are inserted in the wrong column. For example, the values of the variable gender might have been pasted in the column corresponding to the age variable. If gender is a string variable (<code>female</code>/<code>male</code>) this would be easy to notice, but if the variable is numeric (<code>1</code>/<code>2</code>) it could be harder to spot. This mistake might affect several variables and multiple observations. Sometimes this can be flagged by simply observing the data frame. See an example below, where it seems at some point in the data manipulation process the data were shifted, as can be seen since the identifier variable (<code>metainstanceID</code>) is assigned to another column (<code>XTOLPW</code>) .</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_1_8_3.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5relationship" class="level3" data-number="4.1.9">
<h3 data-number="4.1.9" class="anchored" data-anchor-id="sec-5relationship"><span class="header-section-number">4.1.9</span> Consistent variable relationships</h3>
<p>The Data Curator should identify the main relationship between variables and check for their consistency. Some of the most common ones to look out for include:</p>
<ul>
<li><p>The age of the respondent should be within the age range acceptable to respond to the interview, and what makes sense with the data (i.e.&nbsp;can a 2-year old child be working?).</p></li>
<li><p>The sum of members in a household broken down by age and gender should be equal to a variable on total household size</p></li>
<li><p>The number of pregnant and lactating women should not be larger than the number of women in the household</p></li>
<li><p>Geographic locations should fall under the administrative units where they are located</p></li>
<li><p>Some questions may only be relevant based on the answer to previous questions (i.e.&nbsp;only for recipients of a given programme, only for households with children, etc.) &nbsp;&nbsp;</p></li>
</ul>
<p>It is important to check and make sure the patterns are consistent, and if in doubt contact the Data Provider.&nbsp;Consider the following example:</p>
<p>&nbsp;</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">camp</th>
<th style="text-align: center;">status</th>
<th style="text-align: center;">programme</th>
<th style="text-align: center;">cash_received</th>
<th style="text-align: center;">parcels_received</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>1</strong></td>
<td style="text-align: center;"><strong>Orange</strong></td>
<td style="text-align: center;"><strong>Refugee</strong></td>
<td style="text-align: center;"><strong>WFP food parcel</strong></td>
<td style="text-align: center;"><strong>250’000</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">Orange</td>
<td style="text-align: center;">Refugee</td>
<td style="text-align: center;">WFP food parcel</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">Pineapple</td>
<td style="text-align: center;">Refugee</td>
<td style="text-align: center;">WFP food parcel</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>4</strong></td>
<td style="text-align: center;"><strong>Lemon</strong></td>
<td style="text-align: center;"><strong>IDP</strong></td>
<td style="text-align: center;"><strong>CBI</strong></td>
<td style="text-align: center;"><strong>250’000</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Pineapple</td>
<td style="text-align: center;">Refugee</td>
<td style="text-align: center;">CBI</td>
<td style="text-align: center;">250’000</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">Pineapple</td>
<td style="text-align: center;">Refugee</td>
<td style="text-align: center;">WFP food parcel</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;"><strong>Lemon</strong></td>
<td style="text-align: center;"><strong>IDP</strong></td>
<td style="text-align: center;"><strong>CBI</strong></td>
<td style="text-align: center;"><strong>250</strong></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>This table includes a couple of obvious errors and one suspicious issue highlighted in blue:</p>
<ul>
<li><p>Line 1 - The refugee household part of the WFP food parcel programme reported receiving <em>cash</em>. This is an obvious error, and the Data Provider should be consulted to see if they can confirm what the correct number of parcels should be or if the data on <code>parcel_received</code> will be a loss.</p></li>
<li><p>Line 5 – The response here is suspicious because is the only household in Pineapple camp that was part of the CBI programme and the only refugee in the dataset that received cash (all others were IDPs). The Data Provider should be consulted just to confirm this is correct.</p></li>
<li><p>Line 7 – The data on the amount of cash received appears to be an error when compared with all other data, most probably the Data Collector didn’t type out all the zeros. This should be confirmed with the Data Provider.</p></li>
</ul>
<p>It will not be possible for a curator to fix and spot all inconsistencies within a dataset. Therefore, we recommend to select some variables in consultation with the Data Provider, that could have a large impact on utility and focus on those.</p>
<p><em>Check and fix inconsistencies in variable relationships in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A simple way to observe variable relationships is to use crosstabs. This can be done very easily in Excel using a pivot table or in R using the table function.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create a crosstab </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>programme,your_dataset<span class="sc">$</span>cash_received)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(your_dataset<span class="sc">$</span>programme,your_dataset<span class="sc">$</span>parcels_received)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the affected records </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>your_dataset[your_dataset<span class="sc">$</span>programme<span class="sc">==</span><span class="st">"WFP food parcel"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(your_dataset<span class="sc">$</span>cash_received),]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress incorrect value</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>cash_received[your_dataset<span class="sc">$</span>programme<span class="sc">==</span><span class="st">"WFP food parcel"</span> <span class="sc">&amp;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">!</span><span class="fu">is.na</span>(your_dataset<span class="sc">$</span>cash_received)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Say the Data Provider confirmed that record 1 received 1 food parcel</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing value</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>parcels_received[your_dataset<span class="sc">$</span>id<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Check work</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>your_dataset[<span class="dv">1</span>,]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Say the Data Provider confirmed that 250 reported by record 7 is a typo</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace incorrect numeric value</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>cash_received[your_dataset<span class="sc">$</span>cash_received<span class="sc">==</span><span class="dv">250</span>] <span class="ot">&lt;-</span> <span class="dv">250000</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Finally, say the Data Provider confirmed that line 5 is correct. As such, nothing needs to be done.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5outliers" class="level3" data-number="4.1.10">
<h3 data-number="4.1.10" class="anchored" data-anchor-id="sec-5outliers"><span class="header-section-number">4.1.10</span> Outliers</h3>
<p>Outliers are data points that differ significantly from other observations. They may be due to variability in the observation or may indicate an error. Using charts (histograms, scatter plots and box plots) and crosstabs is a good way to spot outliers. The treatment of outliers should be decided in consultation with the Data Provider.</p>
<p>Note: Outliers may be treated differently in the cleaning and anonymization process. In the cleaning process, they should only be removed or modified if the value is wrong. Another approach may be to flag the outliers instead of fixing them. In the case that the outlier is in a key variable and is not wrong (i.e.&nbsp;a true outlier), then this record will likely increase the risk of disclosure of that particular Data Subject and may need to be treated to lessen the risk. This is addressed in the next chapter.</p>
<p>Consider the simplified example below with three variables, <code>id</code>, <code>income_source</code>, <code>income_1month</code></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 x 3
      id income_source                income_1month
   &lt;dbl&gt; &lt;chr&gt;                                &lt;dbl&gt;
 1     1 Factory employee                     20000
 2     2 Factory employee                      6000
 3     3 Factory employee                      7000
 4     4 Factory employee                      6000
 5     5 Factory employee                      5000
 6     6 Factory employee                      5000
 7     7 Factory employee                      6000
 8     8 Seller / Commercial activity         37000
 9     9 Seller / Commercial activity         39000
10    10 Seller / Commercial activity        400000
11    11 Agriculture / Sale of crops           5000
12    12 Agriculture / Sale of crops           4500
13    13 Agriculture / Sale of crops           4000
14    14 Agriculture / Sale of crops           4700
15    15 Livestock / Sale of animals           7500</code></pre>
</div>
</div>
<p>At first glance, it looks as if there may be a couple outliers, particularly record 1 and 10. The following outlines various ways to explore the outliers in R.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the example above, and for the dataset "outliers", simple way to start is to look at the summary of the variable</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of variable</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(outliers<span class="sc">$</span>income_1month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   4000    5000    6000   37113   13750  400000 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of variable with a condition</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(outliers<span class="sc">$</span>income_1month[outliers<span class="sc">$</span>income_source<span class="sc">==</span><span class="st">"Factory employee"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   5000    5500    6000    7857    6500   20000 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate outlier cutoff of 1.5x the interquartile range </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>review_outliers <span class="ot">&lt;-</span> <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(outliers<span class="sc">$</span>income_1month)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(review_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13125</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of income_1month</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(outliers<span class="sc">$</span>income_1month, <span class="at">xlab=</span><span class="st">"Income 1 month"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="anonymize_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable for months in thousands to make it easier to read on chart and recreate histogram defining the number of breaks to ensure can see outliers clearly</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>outliers<span class="sc">$</span>income_1month_thousands <span class="ot">&lt;-</span> outliers<span class="sc">$</span>income_1month<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(outliers<span class="sc">$</span>income_1month_thousands,<span class="at">xlab=</span><span class="st">"Income 1 month in thousands"</span>, <span class="at">breaks =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="anonymize_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot of income_1month</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(outliers<span class="sc">$</span>id, outliers<span class="sc">$</span>income_1month_thousands, <span class="at">xlab=</span><span class="st">"ID"</span>, <span class="at">ylab=</span><span class="st">"Income 1 month in thousands"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="anonymize_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create boxplot of income_1month</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(outliers<span class="sc">$</span>income_1month_thousands, <span class="at">ylab=</span><span class="st">"Income 1 month in thousands"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="anonymize_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create boxplot of the income_1month variable split by income_source </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(income_1month_thousands<span class="sc">~</span>income_source, <span class="at">data =</span> outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="anonymize_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5constreport" class="level3" data-number="4.1.11">
<h3 data-number="4.1.11" class="anchored" data-anchor-id="sec-5constreport"><span class="header-section-number">4.1.11</span> Consistency primary analysis / report</h3>
<p>If an analytical piece or report has been produced with the dataset, consistency between the raw/clean version of the data and the analysis/report should be checked<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Sharing a dataset that differs with the report will later result in confusion and requests for clarification from the final users. The following is list of the minimum issues to check before moving on to the next stage of curation.</p>
<ul>
<li><p>The total number of observations in the dataset is the same as reported in the analysis/report.&nbsp;</p></li>
<li><p>The main key indicators presented in the analysis/report can be correctly calculated from the dataset.&nbsp;</p></li>
<li><p>Most of the variables used in the analysis/report or in the data collection form/questionnaire are in the dataset. Note that some variables may be missing if there were issues in their collection, however in general anything reported against should at least be present in the clean version of the dataset even if some need to be removed for the anonymous version (discussed in next chapter).</p></li>
</ul>
<p>Any discrepancies should be discussed with the Data Provider and documented in the metadata on RIDL.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5consent" class="level3" data-number="4.1.12">
<h3 data-number="4.1.12" class="anchored" data-anchor-id="sec-5consent"><span class="header-section-number">4.1.12</span> Consent</h3>
<p>In some cases, the data will include a variable associated with a question on the “consent” of the Data Subject. The subject of what this “consent” entails will depend on the data exercise and should be available from the Data Provider. The following provides an overview of some of the typical cases, and how they should be treated AFTER consultation with the Data Provider:</p>
<ul>
<li><p>Normally if the data subject did not provide consent, the data will still include a record for that data subject but all variables after the consent variable will be left blank or <code>NA</code>. This can help facilitate calculating the response rate. If the record only includes whether or not they provided consent, and information related to the strata (i.e.&nbsp;camp, province, district, etc.), if applicable, and a unique ID or index, then the variable can be preserved.</p></li>
<li><p>In cases where a respondent did not provide consent and some personal information is still present, all this personal information must be removed.</p></li>
<li><p>In cases where the Data Provider advises that the entire record is removed, the entire record should be removed.</p></li>
</ul>
<p><em>Removing data from records that did not provide consent in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove information from your_variable for records when your_consent_variable is “No”</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_consent_variable<span class="sc">==</span><span class="st">"No"</span>]<span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#example of removing a record whose consent is “No” using dplyr</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>your_consent_variable<span class="sc">==</span><span class="st">"No"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop records with missing consent using dplyr</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(your_consent_variable)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only records where response to consent is 1 or NA using subset function</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">subset</span>(your_dataset,your_dataset<span class="sc">$</span>your_consent_variable <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">is.na</span>(your_dataset<span class="sc">$</span>your_consent_variable))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop records with no consent which was reported as either "No" or "No consent" in this example using dplyr</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>your_consent_variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"No consent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5id" class="level3" data-number="4.1.13">
<h3 data-number="4.1.13" class="anchored" data-anchor-id="sec-5id"><span class="header-section-number">4.1.13</span> Unique ID</h3>
<p>Every data table should have a unique ID, either auto-generated by the data collection software or manually generated by the Data Provider. If this is not already present, it should be created for the clean version of the data table so that reference can be made to the data table. A simple <span class="math inline">\(1:n\)</span> can be created.</p>
<p><em>Create a unique ID</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a unique ID using numbers 1:n and place it at the beginning of the data table </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>unique_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(your_dataset) </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">select</span>(your_dataset, unique_id, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In addition to the original unique ID, a pseudoID should be created that can be used to re-link the clean version of the data with the eventual anonymous version (because the original unique ID will be removed as part of the anonymization). Before it is necessary to randomize data rows because their original order may be used to guess some anonymized values. For example, household data may have been recorded by a particular geographical order, or the household members could have been interviewed from the oldest to the youngest.</p>
<p><em>Create pseudo unique ID</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly shuffle data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(your_dataset))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[rows, ]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># assign new id, ranging 1 to n, and position it before the original id</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>pseudo_unique_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(your_dataset) </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="st">"pseudo_unique_id"</span>, <span class="at">.before =</span> <span class="st">"unique_id"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Be mindful that this code will generate a new pseudo ID every time you run it. If you are removing observations at a later stage based on the new pseudo ID, you will have to adjust the code every time. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5weights" class="level3" data-number="4.1.14">
<h3 data-number="4.1.14" class="anchored" data-anchor-id="sec-5weights"><span class="header-section-number">4.1.14</span> Prepare weights</h3>
<p>To calculate the risk of re-identification of data subjects, the weight of a given data subject needs to be adequately estimated. If the data are from a sample, for example, the weight of any given record is much larger than that from a full enumeration or census where every single data subject is found within the dataset. Design weights (also referred to as base weights or raw weights) in sample data are the number of units in a population that each unit in the sample represents (i.e.&nbsp;if each unit in a sample represents five units in the population, the design weight is 5).</p>
<p><strong>Note</strong> While weights may not be used for analysis of a self-weighted sample as each record equally represents its profile in the population of interest, they still need to be calculated for SDC to property calculate the risk of re-identification of data subjects in a dataset. This is because each record only represents a certain proportion of the overall population, which reduces the risk of re-identification as compared to a full enumeration or census.</p>
<p>For example, the weight of each record in a full enumeration or census would be equal to <code>1</code> (meaning the probability of selection is <span class="math inline">\(1/1\)</span>) whereas the raw weight of each record in a simple random sample of 50 individuals out of a total of 200 individuals would be 4 (meaning the probability of selection is <span class="math inline">\(1/4\)</span>).</p>
<p><code>sdcMicro</code> uses the universal weight <code>1</code> if no weight is provided, equating data to a full enumeration or census. As such, full enumeration or census data do not need weights before going into <code>sdcMicro</code>. If the microdata is from probabilistic sample surveys, each observation should have a corresponding weight, calculated by Data Provider based on the sampling methods used to design the study.&nbsp; Unfortunately, weights are not always provided in the data, in which case they should be requested to the Data Provider. In the simplest sampling designs, weights can be added to sample data using the following formulas.</p>
<p>In <code>sdcMicro</code>, normalized weights cannot be used.</p>
<p>&nbsp;</p>
<section id="sec-5srs" class="level4" data-number="4.1.14.1">
<h4 data-number="4.1.14.1" class="anchored" data-anchor-id="sec-5srs"><span class="header-section-number">4.1.14.1</span> Simple Random Sampling</h4>
<p>In the case of simple random sampling, where each respondent has an equal probability of being included in the sample, the design weight is calculated for all records in the dataset using the following formula:</p>
<p><span class="math display">\[
\text{survey weight = }{\frac{\text{Total number of potential data subjects in sample frame}}{\text{Total number of surveyed data subjects}}}
\]</span></p>
<p>&nbsp;</p>
<p><em>Create sample weights in R for a sample frame of 6000 subjects</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create design weight variable</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">6000</span><span class="sc">/</span><span class="fu">nrow</span>(your_dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5strrs" class="level4" data-number="4.1.14.2">
<h4 data-number="4.1.14.2" class="anchored" data-anchor-id="sec-5strrs"><span class="header-section-number">4.1.14.2</span> Stratified Random Sampling</h4>
<p>In a stratified random sampling, where the population of interest is divided in distinct strata and samples are drawn separately from each stratum, the design weight needs to be calculated for each stratum using the following formula:</p>
<p><span class="math display">\[
\text{survey weight = }{\frac{\text{Total number of pot. data subjects in strata 1’s sample frame}}{\text{Total number of surveyed data subjects in strata 1}}}
\]</span>&nbsp;</p>
<p><em>Adding weights to a dataset that used stratified random sampling in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The following is an example for creating a design weight variable called weight in your_dataset with two strata: camp1 has 300 households and camp2 has 700 households in the sample frame.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create design weight variable for each stratum</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">survey_weight =</span> <span class="fu">case_when</span>(camp <span class="sc">==</span> <span class="st">"camp1"</span><span class="sc">~</span> <span class="dv">1000</span><span class="sc">/</span><span class="dv">300</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                            camp <span class="sc">==</span> <span class="st">"camp2"</span><span class="sc">~</span> <span class="dv">1000</span><span class="sc">/</span><span class="dv">700</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5saveclean" class="level3" data-number="4.1.15">
<h3 data-number="4.1.15" class="anchored" data-anchor-id="sec-5saveclean"><span class="header-section-number">4.1.15</span> Save clean version and cleaning script</h3>
<p>If any modifications/cleaning measures were taken in the previous steps, a clean version (or new clean version) of the file can be saved and uploaded to RIDL. If the initial data was the raw version, this should be saved as version 1.1. If the initial version was a clean version (e.g.&nbsp;version 1.1), this one should be stored as a new version (e.g.&nbsp;version 1.2). Additionally, the R script used to create this version should be saved and uploaded to RIDL with the clean version. This is most easily done in the r studio interface by going to File &gt; Save As.</p>
<p><em>Exporting data in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the haven package, you can export your_clean_data with the following code:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(your_clean_data,<span class="st">"0_data/clean/your_clean_data.csv"</span>,<span class="at">row.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Export dta</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write.dta</span>(your_clean_data,<span class="st">"0_data/clean/your_clean_data.dta"</span>, <span class="at">version =</span> <span class="dv">11</span>, <span class="at">label =</span> <span class="fu">attr</span>(data, <span class="st">"label"</span>))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Export RDS, R"s data format</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(your_clean_data, <span class="st">"0_data/clean/your_clean_data.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5anon" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-5anon"><span class="header-section-number">4.2</span> Anonymization</h2>
<p>Anonymization is an iterative process involving three stages: <strong>assess the risk of re-identification, reduce the risk of re-identification (i.e., anonymize), and assess the utility of the data (or loss of information)</strong>. While each stage is distinct in its method and purpose and the process always starts with assessing the risk, the process involves moving back and forth between the stages until the data has been effectively rendered anonymous, as shown in the figure below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>UNHCR uses Statistical Disclosure Control (SDC) methods to assess and reduce the risk of re-identification of data subject in each dataset. This handbook does not include theory around anonymization, statistical disclosure control and other methods of minimizing disclosure risk as several available resources from the humanitarian and development field on the topic already exist. For theory, the two that are most often referred to by the Data Curation Team include:</p>
<ul>
<li><p><a href="https://sdctheory.readthedocs.io/en/latest/">Statistical Disclosure Control for Microdata: Theory</a> developed by the World Bank</p></li>
<li><p><a href="https://centre.humdata.org/learning-path/disclosure-risk-assessment-overview/?">An Introduction to Disclosure Risk Assessment</a> developed by the UN OCHA Centre for Humanitarian Data</p></li>
</ul>
<p>Every dataset has its own characteristics, so this guidance should be considered indicative only. Some cases will require more steps than others.</p>
<p>The main part of this section covers the classic example of a household or individual level microdataset(that is not hierarchical).&nbsp;Annex – Further guidance on anonymization provides more details on the following:</p>
<ul>
<li><p>Household surveys</p></li>
<li><p>Cash-based intervention (CBI) post-distribution monitoring (PDM) surveys</p></li>
<li><p>proGres data</p></li>
<li><p>SENS survey data</p></li>
<li><p>WASH survey data</p></li>
</ul>
<p>This section is written under the assumption that the data has already been checked for (see <a href="#sec-5datacheck"><span>Section&nbsp;4.1</span></a>) and all the preliminary information needed for anonymization has been compiled <a href="./indentify_data.html#sec-4compileinfo">see Compile Info</a></p>
<p><strong>Anonymization checklist</strong></p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="">Remove variables that will not be published</p></li>
<li><p><input type="checkbox" disabled="">Prepare sample (if relevant)</p></li>
<li><p><input type="checkbox" disabled="">Assess risk</p></li>
<li><p><input type="checkbox" disabled="">Reduce risk</p></li>
<li><p><input type="checkbox" disabled="">Assess utility</p></li>
<li><p><input type="checkbox" disabled="">Add/modify labels</p></li>
<li><p><input type="checkbox" disabled="">Save anonymous version and script</p></li>
</ul>
<p>&nbsp;</p>
<section id="sec-5newanondat" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="sec-5newanondat"><span class="header-section-number">4.2.1</span> Create new dataframe</h3>
<p>If working continuously in r, create a new data frame labelled anonymous (e.g.&nbsp;<code>data_anonymous</code>) that is distinct from the clean version (e.g.&nbsp;<code>data_clean</code>) so that comparisons can be made later as part of the utility analysis.</p>
<p><em>Create a new dataframe in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create anonymous version</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>your_anonymous_data <span class="ot">&lt;-</span> your_clean_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5removeanon" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="sec-5removeanon"><span class="header-section-number">4.2.2</span> Remove variables that will not be published</h3>
<p>Any variables that were preserved with the clean version of the data but will not be released with the public version should be removed at this stage.</p>
<p><em>Variables to be removed from publicly released version of data</em></p>
<ul>
<li><p><strong>Direct identifiers</strong> – If some were kept in the clean data, such as unique IDs to link to other datasets, they should now be removed.</p></li>
<li><p><strong>Sensitive variables</strong> - It may also be necessary to remove variables that are considered too sensitive for a release in a given context, for example, responses to questions about subjects of violence, religion or ethnicity. You should always consult with the Data Provider about the sensitivity of variables, always and especially when in doubt.</p></li>
<li><p><strong>Key variables that cannot be released</strong> - Sometimes, during the anonymization process, you may realize that it would not be possible to sufficiently anonymize certain key variables. For example, a key variable with a lot of variation such as the name of the camp/village in a dataset that includes over 20 different camps and villages. In this case, you may decide to try to go through the SDC process with this variable as a key variable, but eventually remove it if it is impossible to anonymize without too much utility loss. More about key variables later in this chapter.</p></li>
<li><p><strong>Free text variables</strong> - Free text variables usually are not useful for the final user analysis and may contain sensitive information. See <a href="#sec-5freetext">Free text variables</a></p></li>
</ul>
<p>The following code can be used to remove variables from a dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This first example is a simple way to remove a single variable.</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a single variable from a dataframe</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#This second example is a simple way to remove multiple variables at the same time</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove multiple variables from a dataframe</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>your_dataset [<span class="fu">c</span>(<span class="st">"your_variable1"</span>, <span class="st">"your_variable2"</span>, <span class="st">"your_variable3"</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#This third example is useful when developing a template to use for multiple datasets, because you can define a number of different identifiers and then R will search for them and remove them if they are found. You will not have any issues if they are not found. Say you want to identify and remove all direct identifiers</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify direct identifiers</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>direct_identifiers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"enumerator_name"</span>, <span class="st">"address_household_number"</span>, <span class="st">"gpsCoordinates"</span>, <span class="st">"unhcr_progres_num"</span>, <span class="st">"telephone_num"</span>) </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if direct identifier variable exists and remove them</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> direct_identifiers){ </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(i <span class="sc">%in%</span> <span class="fu">colnames</span>(your_dataset))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>{ your_dataset <span class="ot">=</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">any_of</span>(i))}</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5sample" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="sec-5sample"><span class="header-section-number">4.2.3</span> Prepare sample (if relevant)</h3>
<p>If the data is census data (or a complete enumeration), it may be necessary to draw a sample of the data for release as opposed to the entire dataset. If the number of observations is small and the re-identification risk low, you can consider releasing the entire dataset. Otherwise, pull a random sample, preferably stratified to increase precision, from the dataset.</p>
<p><em>Extracting a sample in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This first example pulls a simple random sample of 20% from your_dataset.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get sample of identifiers </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>id_var <span class="ot">&lt;-</span> <span class="st">"id"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>sample_percentage <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>sample_ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(your_dataset[[id_var]], <span class="at">size =</span> <span class="fu">round</span>(sample_percentage <span class="sc">*</span> <span class="fu">nrow</span>(your_dataset)))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create weight and sample</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">nrow</span>(your_dataset) <span class="sc">/</span> <span class="fu">length</span>(sample_ids)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[ your_dataset[[id_var]] <span class="sc">%in%</span> sample_ids ,]</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#This second example pulls a stratified simple random sample using the "camp" as strata. Note this is done using the dplyr package.</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># install the "dplyr" package if not already</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw a proportionately stratified sample, in this case 20%.</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>your_dataset_sample <span class="ot">=</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(camp) <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.2</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw a sample where the same number of observation is pulled from each strata, in this case 50.</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>your_dataset_sample <span class="ot">=</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(camp) <span class="sc">%&gt;%</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that once the sample is drawn, the weights then need to be added. See <a href="#sec-5weights">Prepare weights</a>.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5assessrisk" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="sec-5assessrisk"><span class="header-section-number">4.2.4</span> Assess risk</h3>
<p>The risk of re-identification is assessed on the key variables<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> and quantitatively analyzed using two main SDC indicators: <span class="math inline">\(k\)</span><strong>-anonymity</strong> and <strong>individual risk</strong>.</p>
<p><strong>k-anonymity</strong></p>
<p>A risk measure that is based on the calculation of the number of observations in a sample sharing the same combination of categorical key variables, where <span class="math inline">\(k\)</span> is the number of data subjects sharing the same combination. An observation violates&nbsp;<span class="math inline">\(k\)</span> - anonymity if the sample frequency count&nbsp;<span class="math inline">\(fk\)</span>&nbsp;is smaller than the specified threshold&nbsp;<span class="math inline">\(k\)</span> , while a dataset satisfies <span class="math inline">\(k\)</span>-anonymity if no observations violate the specified <span class="math inline">\(k\)</span>-anonymity threshold. The risk measure is the number of observations that violates <span class="math inline">\(k\)</span>-anonymity for a certain value of&nbsp;<span class="math inline">\(k\)</span>, which can be calculated using <code>sdcMicro</code>.</p>
<p><strong>Individual risk</strong></p>
<p>The probability of correct re-identification of any of the observations in the dataset.</p>
<p><strong>Risk thresholds</strong></p>
<p>UNHCR”s thresholds for SDC for anonymizing the personal microdata of PoCs are presented in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Indicator</th>
<th style="text-align: center;">Threshold</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">k-anonymity</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">Unique combination of key variables is shared by at least three (3) observations in the data</td>
</tr>
<tr class="even">
<td style="text-align: center;">individual risk</td>
<td style="text-align: center;">&lt;15%</td>
<td style="text-align: center;">No one observation has greater than 15% chance of re-identification</td>
</tr>
</tbody>
</table>
<p>Certain cases, outlined below, may require the thresholds to be adjusted. The final decision about how to treat these two cases rests with the Personal Data Controller, with support from the Data Provider, Data Protection Focal Point and Data Curator, and in consultation with the Chief DPO as necessary.</p>
<ul>
<li>For certain personal microdata of PoCs, it may be determined that these thresholds need to be adjusted to allow for lower risk (i.e., in the case of sensitive microdata). If the risk of disclosure needs to be lower, <span class="math inline">\(k\)</span>-anonymity could be higher and/or the individual risk threshold lower.</li>
</ul>
<p>For personal microdata of PoCs derived from a full enumeration or census (i.e., not a sample), personal microdata that is not fully anonymized according to the thresholds listed above, or personal microdata that may be particularly sensitive or that contains sensitive data or information, UNHCR needs to either consider stricter SDC parameters (as outlined under point a) or a stricter Terms of Use (e.g., release data on the MDL as a Licensed Use File rather than a Public Use File).</p>
<p>&nbsp;</p>
<section id="sec-5keyvars" class="level4" data-number="4.2.4.1">
<h4 data-number="4.2.4.1" class="anchored" data-anchor-id="sec-5keyvars"><span class="header-section-number">4.2.4.1</span> Define and prepare key variables</h4>
<p>SDC methods used in the anonymization process to reduce the risk of re-identifying data subjects focus on the analysis of key variables, namely factor (categorical) key variables or continuous variables that are converted to factor (categorical) as part of re-coding, and manipulations to the data focus on these key variables. Before diving into <code>sdcMicro</code>, it”s important to already know which variables will be key variables.</p>
<p>Key variables are context specific, and therefore need to be identified for each dataset based on the possible disclosure scenarios. Annex - Key and sensitive variables&nbsp; provides a more comprehensive list of common key and sensitive variables as well as appropriate anonymization techniques. Annex – &nbsp;includes a list of key variables for specific datasets and surveys.</p>
<p>Only factor key variables are used as part of the risk assessment calculation. It is possible to input continuous (numeric) key variables into <code>sdcMicro</code>, however they are not used as part of the analysis of <span class="math inline">\(k\)</span>-anonymity, individual or global risk. As such, discrete numeric variables or numeric variables with a finite number of responses such as age, household size, number of children in household, etc. should be treated as factor in <code>sdcMicro</code>. The following code provides an example of how to convert key variables to factor.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert categorical key variables to factor</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(your_dataset<span class="sc">$</span>your_variable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Additionally, only missing values coded as <code>NA</code> are read as ‘<code>NA</code>’ by <code>sdcMicro</code> so it is important that missing values in a key variable are coded as such and not, for example, 0, 99, etc. If this was not already done as part of the data check and preparation process, it should be done now.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode missing value code 99 to NA </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable<span class="sc">==</span> <span class="dv">99</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-ghostvars" class="level4" data-number="4.2.4.2">
<h4 data-number="4.2.4.2" class="anchored" data-anchor-id="sec-ghostvars"><span class="header-section-number">4.2.4.2</span> Define ghost variables</h4>
<p>Variables that might be linked to key variables are considered ‘ghost variables’ in SDC. Some examples below:</p>
<ul>
<li><p>the name of a refugee camp is linked to the region where it is located;</p></li>
<li><p>variables associated with the disaggregation of total number of household members (e.g.&nbsp;by gender, age, etc.) are ghost variables of total number of household members; and</p></li>
<li><p>income per capita is a ghost variable of household size, etc.</p></li>
</ul>
<p>The response to a ghost variable should be removed from the dataset if the response to their associated key variable is removed, and this key variable can be recalculated from the ghost variable.</p>
<p><em>Defining ghost variables to be used by <code>sdcMicro</code> in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up blank list that will be used to define ghost variables</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>selectedGhostVars <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Each linkage is a list, with the first element the key variable and the second element the linked variable(s)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"total_hh_size"</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]][[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hh_mem_0-17_yrs"</span>,<span class="st">"hh_mem_18_59_yrs"</span>,<span class="st">"hh_mem_60_yrs"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># If the dataset has more than one set of ghost variables, this can simply be added using the following</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"total_hh_size"</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">1</span>]][[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hh_mem_0-17_yrs"</span>, <span class="st">"hh_mem_18_59_yrs"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"hh_mem_60_yrs"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">2</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"region"</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>selectedGhostVars [[<span class="dv">2</span>]][[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"camp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5sdcobj" class="level4" data-number="4.2.4.3">
<h4 data-number="4.2.4.3" class="anchored" data-anchor-id="sec-5sdcobj"><span class="header-section-number">4.2.4.3</span> Create the SDC risk assessment (or SDC problem)</h4>
<p>To initialize the SDC risk assessment (or SDC problem in <code>sdcMicro</code>), the SDC object (<code>sdcObject</code>) needs to first be created. The <code>sdcObject</code> encompasses all parameters that feed into the risk assessment. The following is a list of these parameters and sample code to create the <code>sdcObject</code>.</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dat</td>
<td>Name of dataset (table) to go through SDC.</td>
</tr>
<tr class="even">
<td>keyVars</td>
<td>Categorical (factor) key variables</td>
</tr>
<tr class="odd">
<td>numVars</td>
<td>Numeric key variables.</td>
</tr>
<tr class="even">
<td>ghostVars</td>
<td>Ghost variables as described in previous section.</td>
</tr>
<tr class="odd">
<td>weightVar</td>
<td>Weight variable. If this is left blank, SDC assumes it is a census and not a sample dataset.</td>
</tr>
<tr class="even">
<td>hhID</td>
<td>Hierarchical identifier, if present. For example, if the table contains individual-level data that is linked to household-level data, then select the variable containing the unique ID for the household.</td>
</tr>
<tr class="odd">
<td>strataVar</td>
<td>The variable that defines the strata (either strata used for sampling or for analysis) used in perturbative methods like PRAM and Microaggregation. Don’t need to specify if it is not relevant.</td>
</tr>
<tr class="even">
<td>pramVars</td>
<td>Variables on which you want to apply the PRAM (post randomization method).</td>
</tr>
<tr class="odd">
<td>excludeVars</td>
<td>Variables to be excluded from the SDC, and as a result dropped from the dataset. It is basically another way to remove variables from the dataset.</td>
</tr>
<tr class="even">
<td>seed</td>
<td>The seed makes it possible to reproduce the same results if you apply probabilistic anonymization methods. Please note that the seed should not be shared externally since it may make it possible to reverse the anonymization process. Always choose a random number, never use the default value.</td>
</tr>
<tr class="odd">
<td>randomizedRecords</td>
<td>If the records should be randomized. Can be TRUE or FALSE.</td>
</tr>
<tr class="even">
<td>alpha</td>
<td>Alpha is the weight with which missing values contribute to the computation of key variables frequencies when calculating k-anonymity. Leave at default value of 1.</td>
</tr>
</tbody>
</table>
<p><em>Setting up an <code>sdcObj</code> in <code>sdcMicro</code></em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The following is an example of setting up a sdcObject with ghost variables selectedGhostVars (see code in previous section) and strata variable camp and weight variable weight.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up sdcMicro object</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">createSdcObj</span>(<span class="at">dat =</span> your_dataset,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keyVars =</span> <span class="fu">c</span>(<span class="st">"your_variable1"</span>, <span class="st">"your_variable2"</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ghostVars =</span> selectedGhostVars,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">numVar =</span> <span class="fu">c</span>(<span class="st">"your_variable3"</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weightVar =</span> <span class="fu">c</span>(<span class="st">"weight"</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pramVars =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">hhId =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">strataVar =</span> <span class="fu">c</span>(<span class="st">"camp"</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">excludeVars =</span> <span class="cn">NULL</span>, </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed =</span> <span class="dv">346</span>, </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">randomizeRecords =</span> <span class="cn">FALSE</span>, </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span><span class="fu">c</span>(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note: In cases where the sdc parameter is not relevant, simply define it as empty or <code>NULL</code> as is shown in the above example. In parameters that call for a variable or a number of variables, the codes should be written as a list using the following syntax: <code>c('variable_name','variable_name')</code>.</p>
</section>
<section id="sec-5readsdcobj" class="level4" data-number="4.2.4.4">
<h4 data-number="4.2.4.4" class="anchored" data-anchor-id="sec-5readsdcobj"><span class="header-section-number">4.2.4.4</span> Interpret the SDC risk assessment</h4>
<p>The SDC risk assessment includes three different groups of quantitative information:</p>
<ul>
<li><p>information on the categorical key variables;</p></li>
<li><p>individual and global risk for categorical key variables; and</p></li>
<li><p>information on k-anonymity.</p></li>
</ul>
<p>&nbsp;</p>
<section id="sec-5overview" class="level5" data-number="4.2.4.4.1">
<h5 data-number="4.2.4.4.1" class="anchored" data-anchor-id="sec-5overview"><span class="header-section-number">4.2.4.4.1</span> General overview and k-anonymity</h5>
<p>The first step may be to get a general overview of the risk assessment, and k-anonymity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Considering your sdcObj, the following code can be used to get a general overview of risk.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of risk assessment results</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>sdcObj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Example SDC risk assessment output</em></p>
<p>The following is the SDC risk assessment from a household survey for a example dataset built-in the sdcMicro library. Note that this is an example of the problem BEFORE any modifications are made to the data. Reprinting the sdcObj after modifications are made will allow to compare the same information before the modifications and after. Each description is associated with the number in the screenshot of the R output.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sdcMicro)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>data_sdcObj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data_sdcObj.RDS"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="do">###Create object</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">createSdcObj</span>(<span class="at">dat=</span>data_sdcObj,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">keyVars=</span><span class="fu">c</span>(<span class="st">"HH_SIZE"</span>, <span class="st">"MARITAL_STATUS"</span>, <span class="st">"REGION"</span>), </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">weightVar=</span><span class="fu">c</span>(<span class="st">"WEIGHT"</span>), </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">hhId=</span><span class="cn">NULL</span>, </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">strataVar=</span><span class="cn">NULL</span>, </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pramVars=</span><span class="cn">NULL</span>, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">excludeVars=</span><span class="cn">NULL</span>, </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed=</span><span class="dv">60</span>, </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">randomizeRecords=</span><span class="cn">FALSE</span>, </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">alpha=</span><span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="do">###Risk assessment results</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>sdcObj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Section 1:</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_2_4_obj1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Brief overview of the dataset that is part of the problem including number of records and variables, list of categorical key and numeric key variables and weight variable. If ghost variables were included, they would be listed here.</p>
<p><em>Section 2:</em></p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="section4_2_4_obj2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Basic description of the categorical key variables, including the number of categories going into the problem. Note that is example is showing unmodified data. If you run the code after the data is modified.</p>
<p><em>Section 3:</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_2_4_obj3.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The number of observations violating 2/3/5-anonymity. To interpret this, you can say that 49.45% of observations in the original dataset do not share the same responses to all categorical key variables with at least 2 other records.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5risk" class="level5" data-number="4.2.4.4.2">
<h5 data-number="4.2.4.4.2" class="anchored" data-anchor-id="sec-5risk"><span class="header-section-number">4.2.4.4.2</span> Individual and global risk</h5>
<p>Carefully examining global and individual risk can help to identify which observations are risky and further which key variable are causing observations to be more/less risky. You can start by printing out more details on the individual and global risk.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Individual and global risk in R</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Considering your sdcObj, the following code can be used to print out details on individual and global risk.</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Details on the global and individual risk</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>sdcObj<span class="sc">@</span>risk</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#If you need further details, the following codes can help to view more about the specific risky observations.</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the 10 largest individual risk measurements</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>sdcObj<span class="sc">@</span>risk<span class="sc">$</span>individual <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(risk)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># List of observations violating 3-anonymity</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>kanon3 <span class="ot">&lt;-</span> your_dataset[sdcObj<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">3</span>,sdcObj<span class="sc">@</span>keyVars]</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>kanon3 <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">#List of observations with individual risk &gt; 0.15 or 15%</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>indv15 <span class="ot">&lt;-</span> your_dataset[sdcObj<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="st">"risk"</span>] <span class="sc">&gt;</span> <span class="fl">0.15</span>,sdcObj<span class="sc">@</span>keyVars]</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>indv15 <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The result first show the measure of global risk followed by a table of individual risk for each observation. In the table on individual risk, there are three columns defined below:</p>
<ul>
<li><p><span class="math inline">\(f_{k}\)</span>= Sample frequency of the keys variables for all observations, whereas those with the same keys variables have the same frequency. If equal to 10, for example, there are 10 observations in the dataset with the same combination of key variables. If equal to <span class="math inline">\(1\)</span>, for example, this observation has a unique combination of key variables and is ‘sample unique.’ By definition, <span class="math inline">\(f_{k}\)</span> is the same for all observations with a given key variable combination.</p></li>
<li><p><span class="math inline">\(F_{k}\)</span> = Population frequency of a combination of key variables, which is the estimated number of respondents in the population with that number of similar combinations of key variables. If the microdata is a sample and not a census, <span class="math inline">\(F_{k}\)</span> is the sum of the sample weights of all observations with the same key variable combination. Hence, like <span class="math inline">\(f_{k}\)</span> is also the same for all observations with a given key variable combination.</p></li>
<li><p>risk or <span class="math inline">\(r_{k}\)</span> = Individual risk or the probability of disclosure for the observations. As with <span class="math inline">\(f_{k}\)</span> and <span class="math inline">\(F_{k}\)</span>, it is the same for all observations sharing the same pattern of values of key variables<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p></li>
</ul>
<p>As the end goal is to have 0 observations violating 3-anonymity and 0% of records with individual risk &gt;0.15 or 15%, it is helpful to print out a list of risky observation in R to understand if there are any trends around which key variables are increasing the level of risk.</p>
<p>&nbsp;</p>
</section>
</section>
</section>
<section id="sec-5reducerisk" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="sec-5reducerisk"><span class="header-section-number">4.2.5</span> Reduce risk</h3>
<p>If the risk assessment shows that the risk is not too high and k-anonymity is three (or the threshold set by the Data Provider and Personal Data Controller if different), then no manipulation needs to be done to the dataset. In this case, the Data Curator can go straight to section <a href="https://unhcr365.sharepoint.com/teams/dpsm-datacuration/Shared%20Documents/General/Guidelines/Microdata_Curation_Handbook/UNHCR-MicrodataCurationHandbook-v5.0.docx#_Save_anonymous_version,">Save anonymous version, codebook and anonymization script</a>. &nbsp;</p>
<p>If the risk assessment shows that the risk is too high, <strong>then the data cannot be released without applying SDC methods.</strong></p>
<p>The goal of SDC is to preserve as much of the data’s original content as possible, while reducing the risk of re-identifying data subjects.</p>
<p><strong>Bear in mind that:</strong></p>
<p>1. Highly perturbative methods including PRAM, microaggregation, noise addition, shuffle and rank swapping should be avoided because they can highly distort the data based on the parameters used.</p>
<p>2. Anonymization is an iterative process, which often requires starting over after attempting to anonymize a dataset once, twice, etc. and not being satisfied with the result and loss in utility. Using R with a save script helps to facilitate retracing your steps and also consult other Data Curators for advice.</p>
<p>An overview of anonymization methods is available in the table below. Complementary information can be found in the <a href="https://sdcpractice.readthedocs.io/en/latest/anon_methods.html">SDC Practice Guide</a>. The technical part of this section focuses on the most used non-perturbative methods. For further support, reach out to <a href="mailto:microdata@unhcr.org" class="email">microdata@unhcr.org</a>.</p>
<p>&nbsp;</p>
<section id="sec-5summarytable" class="level4" data-number="4.2.5.1">
<h4 data-number="4.2.5.1" class="anchored" data-anchor-id="sec-5summarytable"><span class="header-section-number">4.2.5.1</span> Summary of anonymization methods</h4>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 67%">
</colgroup>
<thead>
<tr class="header">
<th>Key variable type</th>
<th>Method</th>
<th>Classification</th>
<th>Explanation and Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Categorical</td>
<td>Recoding</td>
<td>non-perturbative, deterministic</td>
<td>Recoding consists of grouping the values of categorical variables into a new variable. This is commonly used to regroup categorical variables with few responses into a larger group. For example, recoding responses with less than XX records to another like category or a group ‘other’.</td>
</tr>
<tr class="even">
<td></td>
<td>Local suppression to achieve k-anonymity</td>
<td>non-perturbative, deterministic</td>
<td>Local suppression set the values of the key variables to missing (suppress) until the desired level of k-anonymity is reached (at least a 3-anonymity level).</td>
</tr>
<tr class="odd">
<td></td>
<td>Suppression of linked (ghost) variables</td>
<td>non-perturbative, deterministic</td>
<td>Suppressing ghost variables involves suppressing the response in a variable that is linked to the response in a key variable to missing if the response to the key variable is also suppressed (or set to missing). This step is necessary when there is a relationship between variables that could be used to reconstruct a suppressed value.</td>
</tr>
<tr class="even">
<td></td>
<td>Suppression of values with high risk</td>
<td>non-perturbative, deterministic</td>
<td>This method consists of suppressing (or setting to missing) the values of key variables for observations that surpass a certain risk threshold. It is most useful when you are aware of few records with high risk. The result depends on the selected key variable. You may need to repeat the suppression selecting other variables so that you remove the values of more than one key variable, or you may undo it and do it again selecting another key to see if you obtain a better result.</td>
</tr>
<tr class="odd">
<td></td>
<td>PRAM (Post RAndomization Method)</td>
<td>perturbative, probabilistic</td>
<td>PRAM consists of randomly changing the values of categorical variables according to an invariant probability transition matrix. This method is especially useful when a dataset contains many key variables, and local suppression and recoding would lead to a significant information loss. One characteristic of the PRAM method implemented by <code>sdcMicro</code> is that univariate tabulations remain the same before and after anonymization for all variables that have been subjected to the method. This kind of implementation is called invariant PRAM. If a particular cross tabulation must be maintained, you can specify a strata argument.</td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Rounding</td>
<td>perturbative, deterministic</td>
<td>Rounding is simply rounding a number up so that it is less precise. It is used to prevent exact matching of continuous key variables with external data sources. In addition, rounding can be used to reduce the level of detail in the data. For example, removing decimal figures of income variable or rounding income variable to the nearest thousand.</td>
</tr>
<tr class="odd">
<td></td>
<td>Top/bottom recoding</td>
<td>perturbative, deterministic</td>
<td>The purpose of top/bottom coding is to remove outliers (observations that lie at an abnormal distance from other values in a random sample from a population) from numeric key variables. Top and bottom coding are similar to recoding, but instead of recoding all values, only the top and/or bottom values of the distribution or categories are recoded. Top and bottom coding is especially useful if the bulk of the values lies in the center with only few observations outside (outliers). Some numeric values common to UNHCR data are related to age, expenditure and income, and usually you will have to top code high values, as there will often be a few observations above certain thresholds, typically at the tails of the distribution.</td>
</tr>
<tr class="even">
<td></td>
<td>Microaggregation</td>
<td>perturbative, probabilistic</td>
<td>Microaggregation is most suitable for continuous variables but can also be used for categorical. It works by grouping records that are homogenous with respect to the values of certain key variables. The values of selected variables are then replaced with a common value, e.g.&nbsp;the mean of that group.</td>
</tr>
<tr class="odd">
<td></td>
<td>Noise addition</td>
<td>perturbative, probabilistic</td>
<td>In noise addition, values are added to or subtracted from the original values of a variable. This prevents exact matching with an external file based on an exact value of a continuous variable.</td>
</tr>
<tr class="even">
<td></td>
<td>Rank swapping</td>
<td>Perturbative, probabilistic</td>
<td>Rank swapping is a type of data swapping used for ordinal continuous variables. Values of the variable are first ordered, and values are swapped with other values that are similar (in the same neighborhood).</td>
</tr>
<tr class="odd">
<td></td>
<td>Shuffle</td>
<td>perturbative, probabilistic</td>
<td>Shuffling is similar to swapping but uses an underlying regression model to determine which variables are swapped.</td>
</tr>
</tbody>
</table>
<p>Many of the commonly used SDC methods can be done without using the <code>sdcMicro</code> package (i.e.&nbsp;using other R packages before entering into the <code>sdcObj</code>) or using specific <code>sdcMicro</code> functions inside the <code>sdcObj</code>. The Data Curator can choose the method most suitable, as long as utility analysis performed afterwards, and the methods are documented for transparency. The example codes below show examples both inside and outside of <code>sdcMicro</code>. Note that in the case that manipulations are performed outside of <code>sdcMicro</code>:</p>
<ol type="a">
<li><p>The risk analysis will only look at the final risk and not the true before and after.</p></li>
<li><p>The utility analysis in the <code>sdcMicro</code> generated report is not relevant because it is comparing a dataset that was already manipulated with the final anonymized version of the dataset. As such, the utility analysis will need to refer to the clean and anonymized data respectively.</p></li>
</ol>
<p>&nbsp;</p>
</section>
<section id="sec-5catkeyvar" class="level4" data-number="4.2.5.2">
<h4 data-number="4.2.5.2" class="anchored" data-anchor-id="sec-5catkeyvar"><span class="header-section-number">4.2.5.2</span> Categorical key variable methods</h4>
<section id="sec-5recoding" class="level5" data-number="4.2.5.2.1">
<h5 data-number="4.2.5.2.1" class="anchored" data-anchor-id="sec-5recoding"><span class="header-section-number">4.2.5.2.1</span> Recoding</h5>
<p>Recoding key variables is a great way to reduce the percentage of records violating 3-anonymity without having to suppress too many values. At the same time, the following two points need to always be considered when recoding:</p>
<ul>
<li><p><strong>Recoding should not cause too much loss of utility</strong>. For example, if indicators need to be calculated for children in school age (elementary and secondary), the recoding of this variable should be according to school year divisions, which would allow for calculations to be made i.e.&nbsp;0-5, 6-11, 12-17. Instead, grouping in five-year intervals (0-5, 5-10, 10-15, 15-20) would greatly decrease the data utility for these users.&nbsp;&nbsp;</p></li>
<li><p><strong>If the variable can be recalculated using other variables, this anonymization method is not useful.</strong> A particular case is household size: in cases that there is an individual-level dataset, it can be recalculated simply by counting the number of individuals. Another example is, in the case of stratified sampling, the variable containing the strata (for example camp or camp zone). All observations in the same strata will have the same weight, so it would be possible to guess the strata just by looking at the unique weight value.</p></li>
</ul>
<p><em>Recoding variables using the <code>sdcMicro</code> package</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Given your sdcObj and the key variables, province_district and total_hh_mem, the following code can be used to recode the variables.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode locations with few observations (Location 1, Location 4 and Location 5) into new group Other</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">groupAndRename</span>(<span class="at">obj=</span>sdcObj, <span class="at">var=</span><span class="st">"province_district"</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">before=</span><span class="fu">c</span>(<span class="st">"Location 1"</span>,<span class="st">"Location 4"</span>,<span class="st">"Location 5"</span>), </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">after=</span><span class="fu">c</span>(<span class="st">"Other"</span>))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode total number of household members into new distinct groups 1, 2, 3-4, 5-6, &gt;6</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">groupAndRename</span>(<span class="at">obj=</span>sdcObj, <span class="at">var=</span><span class="st">"total_hh_mem"</span>, <span class="at">before=</span><span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"4"</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">after=</span><span class="fu">c</span>(<span class="st">"3-4"</span>), <span class="at">addNA=</span><span class="cn">FALSE</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">groupAndRename</span>(<span class="at">obj=</span>sdcObj, <span class="at">var=</span><span class="st">"total_hh_mem"</span>, <span class="at">before=</span><span class="fu">c</span>(<span class="st">"5"</span>,<span class="st">"6"</span>),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">after=</span><span class="fu">c</span>(<span class="st">"5-6"</span>), <span class="at">addNA=</span><span class="cn">FALSE</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">groupAndRename</span>(<span class="at">obj=</span>sdcObj, <span class="at">var=</span><span class="st">"total_hh_mem"</span>, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">before=</span><span class="fu">c</span>(<span class="st">"7"</span>,<span class="st">"8"</span>,<span class="st">"9"</span>,<span class="st">"12"</span>), <span class="at">after=</span><span class="fu">c</span>(<span class="st">"&gt;6"</span>), <span class="at">addNA=</span><span class="cn">FALSE</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#See risk summary after recoding</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>sdcObj </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Recoding variables outside sdcMicro </span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Given the key variable age, there are a couple different methods to recode the age into groups. The first one is useful if the group value labels can be stored directly in the variable. The second one, using dplyr, is useful if the values are encoded with labels.</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode age into 7 distinct groups method 1</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">cut</span>(your_dataset<span class="sc">$</span>age, </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="cn">Inf</span>), </span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"15-19"</span>, <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>, <span class="st">"45-49"</span>))</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode age into 7 distinct groups method 2 using dplyr</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">case_when</span>(your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">19</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">24</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">29</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">30</span><span class="sc">:</span><span class="dv">34</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">35</span><span class="sc">:</span><span class="dv">39</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">44</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>                    your_dataset<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">49</span> <span class="sc">~</span> <span class="dv">7</span>)</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co"># add labels to the codes</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="fu">val_labels</span>(your_dataset<span class="sc">$</span>age) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"15-19"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"20-24"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"25-29"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"30-34"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"35-39"</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">"40-44"</span> <span class="ot">=</span> <span class="dv">6</span>,</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"45-49"</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="co">#After this, the data can run through sdcMicro.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5localsuppression" class="level5" data-number="4.2.5.2.2">
<h5 data-number="4.2.5.2.2" class="anchored" data-anchor-id="sec-5localsuppression"><span class="header-section-number">4.2.5.2.2</span> Local suppression</h5>
<p>Local suppression is used to <strong>suppress</strong> observations until <span class="math inline">\(k\)</span>-anonymity is reached.</p>
<p>In cooperation with the Data Provider, key variables can be ranked by Data Curators in order of importance, meaning that some key variables will be preserved as much as possible compared to others during the anonymization process. So, for example, the location of a household may be more important than the gender of the head of household which may be considered more important than the age of the head of household. Please note however that using an importance vector will lead to a higher total number of suppressed values in the less important variables. Remember to indicate any ghost variables associated with a key variable before applying local suppression. See section <a href="#sec-ghostvars">Define ghost variables</a>.</p>
<p><em>Local suppression in sdcMicro</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The following code locally suppresses to reach 3-anonymity. The importance variables are coded according to the order in which they were listed in the sdcObj. So, for example, 1 is the first variable listed, 2 is the second, etc.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Local suppression to obtain 3-anonymity</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">kAnon</span>(sdcObj, <span class="at">importance=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">5</span>), <span class="at">combs=</span><span class="cn">NULL</span>, <span class="at">k=</span><span class="fu">c</span>(<span class="dv">3</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># See risk summary after local suppression</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>sdcObj</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#localSupp function can be used to perform local suppression on a single key variable. This is particularly useful if the individual risk of certain records is still above the desired threshold (ie. 15%). </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Local suppression to reach 15% individual risk</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">localSupp</span>(sdcObj, <span class="at">threshold =</span> <span class="fl">0.15</span>, your_key_variable)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># See risk summary after local suppression </span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>sdcObj</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Undo the last local suppression – note this only undoes the last</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">=</span> <span class="fu">undolast</span>(sdcObj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp; #### Numeric key variable methods {#sec-numerickeyvar}</p>
<p>Numeric key variables that cannot be considered factor are not used to calculate <span class="math inline">\(k\)</span>-anonymity or individual risk. This increases the importance for direct communication with the Data Provider on the disclosure risk given the level of detail in numeric key variables. Two common methods for decreasing the level of detail in numeric key variables are rounding and top/bottom coding.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5rounding" class="level5" data-number="4.2.5.2.3">
<h5 data-number="4.2.5.2.3" class="anchored" data-anchor-id="sec-5rounding"><span class="header-section-number">4.2.5.2.3</span> Rounding</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example using  sdcMicro</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sdcObj<span class="sc">@</span>manipKeyVars<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">round</span>(sdcObj<span class="sc">@</span>manipKeyVars<span class="sc">$</span>your_variable)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># example not using sdcMicro</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable <span class="ot">&lt;-</span> <span class="fu">round</span>(your_dataset<span class="sc">$</span>your_variable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp; ##### Top/bottom coding {#sec-5topcode}</p>
<p>Top/bottom coding variables in R and sdcMicro</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example using  sdcMicro</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>sdcObj <span class="ot">&lt;-</span> <span class="fu">topBotCoding</span>(sdcObj, <span class="at">value=</span><span class="dv">500000</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement=</span><span class="dv">1000</span>, <span class="at">column=</span><span class="st">"your_variable"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># example not using sdcMicro</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>your_dataset<span class="sc">$</span>your_variable[your_dataset<span class="sc">$</span>your_variable <span class="sc">&gt;=</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5removerecords" class="level4" data-number="4.2.5.3">
<h4 data-number="4.2.5.3" class="anchored" data-anchor-id="sec-5removerecords"><span class="header-section-number">4.2.5.3</span> Removing records</h4>
<p>In some cases, entire records may need to be suppressed either because they are too risky (e.g.&nbsp;the individual risk for a particular record is very high) or they are linked to another variable that can be used to re-calculate a key variable that was manipulated (i.e.&nbsp;suppressed, top coded, etc.). Consider the following two examples:</p>
<ol type="1">
<li><p>In a hierarchical dataset that includes two tables (one with the household at the subject and the other with the household members as the data subject). If all household members are interviewed, the household size can be calculated from the household member table. In this case, if there are manipulations to a variable that provides the size of the household in the household table, the responses to the variable can be recalculated based on the household member table by simply counting the number of members per household. One option to manage this situation, you could firstly top code the household size in the household data table, then randomly remove individuals from the household member table whose households exceed the threshold.</p></li>
<li><p>Data were gathered using stratified sampling and the strata correspond with different refugee camps and all observations in the same camp have the same survey weight. If the some of the observations in the camp variable are removed through local suppression, it is still easy to guess the camp through the survey weight. Since the survey weight cannot and should not be removed, the first solution would be to prioritize the camp variable when performing local suppression (see <a href="#sec-5localsuppression">Local suppression</a>) and the second solution would be to remove the records where the camp was suppressed from the anonymous version of the data table (if avoiding suppression is not possible).</p></li>
</ol>
<p>Note that suppressing records is not possible using any functions of the <code>sdcMicro</code> package.</p>
<p><em>Supressing records in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Given key variable camp:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#example of removing records outside of sdcMicro where the variable camp is blank</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[<span class="sc">!</span><span class="fu">is.na</span>(your_dataset<span class="sc">$</span>camp),]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#example of removing row number 134 outside of sdcMicro</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">134</span>),]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#example of removing a record whose hh_id is "ABC" using dplyr package</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>hh_id<span class="sc">==</span><span class="st">"ABC"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of removing records using subset function with two conditions</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>your_dataset <span class="ot">&lt;-</span> <span class="fu">subset</span>(your_dataset,your_dataset<span class="sc">$</span>your_variable <span class="sc">==</span> <span class="st">"ABC"</span> <span class="sc">|</span> your_dataset<span class="sc">$</span>your_variable<span class="sc">==</span><span class="st">"DEF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="sec-5reassessrisk" class="level4" data-number="4.2.5.4">
<h4 data-number="4.2.5.4" class="anchored" data-anchor-id="sec-5reassessrisk"><span class="header-section-number">4.2.5.4</span> Reassess risk</h4>
<p>After performing relevant SDC methods, the Data Curator re-evaluates the disclosure risk on the anonymized data using the same methods described in section <a href="#sec-5readsdcobj">Interpret the SDC risk assessment</a>. The <code>sdcObject</code> summary will display k-anonymity before and after any manipulations that were done inside of the <code>sdcObject</code>. As previously stated, it is important to remember that if any manipulations were done outside of the sdcObject, they will not be factored in this analysis.</p>
<p>&nbsp;</p>
</section>
<section id="sec-5exportingsdc" class="level4" data-number="4.2.5.5">
<h4 data-number="4.2.5.5" class="anchored" data-anchor-id="sec-5exportingsdc"><span class="header-section-number">4.2.5.5</span> Exporting data from SDC object</h4>
<p>Once you are satisfied with an anonymized version of the data, it needs to be exported out of the <code>sdcObject</code> to assess utility and for the last fixes before release. This can be done using the following code.</p>
<p><em>You can export the anonymized version of the data, <code>your_anonymous_data</code>, using the following</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export anonymized data file and save to disk (extract sdcObj)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>your_anonymous_data <span class="ot">&lt;-</span> <span class="fu">extractManipData</span>(sdcObj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5assessutility" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="sec-5assessutility"><span class="header-section-number">4.2.6</span> Assess utility and utility loss</h3>
<p>Once the risk thresholds are met, a comparison between the clean and anonymous version needs to be made focusing on re-calculating the main indicators and cross-tabulations of interest for analysis and research. If the difference is statistically significant, the SDC method will need to be repeated until the utility is preserved. If the utility cannot be preserved due to information loss in the anonymization process, then the microdata may not be relevant for external publication on the MDL.</p>
<p>The focus here is on those variables that may have been modified, e.g.&nbsp;the key variables. In datasets where entire records were suppressed, all variables in the dataset were modified and any of potential interest to Data Users need to be reviewed.</p>
<p>Utility checks greatly depend on the kind of dataset and the needs of the final user. Common utility checks are:</p>
<ol type="1">
<li><strong>Comparing published reports</strong> - If reports based on the dataset have been published, you should recalculate the main statistics on the anonymized dataset and verify that very similar results are obtained.</li>
<li><strong>Categorical key variables and variables of interest -</strong> Compare the distribution of the original dataset against the anonymized one. To establish if any differences are statistically significant, you can compare the confidence intervals on the proportions.</li>
<li><strong>Continuous key variables and variables of interest –</strong> Compare the same descriptive statistics on both the original dataset and the anonymized. For example, compare the means and standard deviations and any other statistics that the end user may need. The aim is to have no statistically significant differences between the dataset before and after the anonymization.</li>
<li><strong>Relationships between variables</strong> - From the report or information shared by the Data Provider, important relationships between variables may have been identified. In this case, it should be established that the relationship between these variables has been maintained.</li>
</ol>
<p>When assessing utility, it is important to compare the anonymous version of the data against the clean version of the data. In some cases, modifications as part of the anonymization process may have been done before the use of <code>sdcMicro</code>. As such, the initial data coming into the <code>sdcObject</code> are not the dataset that should be used for comparison but the version before any manipulations were made.</p>
<p>&nbsp;</p>
<section id="sec-5utilitycatvars" class="level4" data-number="4.2.6.1">
<h4 data-number="4.2.6.1" class="anchored" data-anchor-id="sec-5utilitycatvars"><span class="header-section-number">4.2.6.1</span> Categorical variables</h4>
<section id="basic-descriptive-statistics" class="level5" data-number="4.2.6.1.1">
<h5 data-number="4.2.6.1.1" class="anchored" data-anchor-id="basic-descriptive-statistics"><span class="header-section-number">4.2.6.1.1</span> Basic descriptive statistics</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Descriptive statistics of categorical variables in R</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare plots</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(your_clean_data<span class="sc">$</span>your_variable) </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Distribution before Anonymization"</span>, <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(your_anonymous_data<span class="sc">$</span>your_variable)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"Distribution after Anonymization"</span>, <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare table distribution</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>table_clean <span class="ot">&lt;-</span> <span class="fu">table</span>(your_clean_data<span class="sc">$</span>your_variable_1, your_clean_data<span class="sc">$</span>your_variable_2,<span class="at">useNA=</span> <span class="st">"always"</span>) </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(table_clean, <span class="dv">1</span>), <span class="dv">2</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>table_anon <span class="ot">&lt;-</span> <span class="fu">table</span>(your_anonymous_data<span class="sc">$</span>your_variable_1, </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>               your_anonymous_data<span class="sc">$</span>your_variable_2,<span class="at">useNA=</span> <span class="st">"always"</span>) </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(table_anon, <span class="dv">1</span>), <span class="dv">2</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate relationship between two categorical variables using chi-squared test </span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(your_clean_data<span class="sc">$</span>your_variable), <span class="fu">table</span>(your_anonymous_data<span class="sc">$</span>your_variable))</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="fu">table</span>(your_clean_data<span class="sc">$</span>your_variable), <span class="fu">table</span>(your_anonymous_data<span class="sc">$</span>your_variable))</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">#The null hypothesis is that there is no difference between the distribution of the variable in the clean version and the anonymous version of the dataset. If the p-value of the test is above the threshold chosen for statistical significance (usually 0.10, 0.05, or 0.01 level), then the null hypothesis cannot be rejected meaning the difference is not statistically significant (what is desired in the utility analysis).</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">#In summary, the p-value should be greater than 0.10 or 0.05 to establish that the difference between the clean and anonymous version of the variable is not statistically significant.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5utilitycontvars" class="level4" data-number="4.2.6.2">
<h4 data-number="4.2.6.2" class="anchored" data-anchor-id="sec-5utilitycontvars"><span class="header-section-number">4.2.6.2</span> Continuous variables</h4>
<section id="basic-descriptive-statistics-1" class="level5" data-number="4.2.6.2.1">
<h5 data-number="4.2.6.2.1" class="anchored" data-anchor-id="basic-descriptive-statistics-1"><span class="header-section-number">4.2.6.2.1</span> Basic descriptive statistics</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare means, covariance and correlations</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(your_clean_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(your_anonymous_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(your_clean_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(your_anonymous_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(your_clean_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(your_anonymous_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(your_clean_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(your_anonymous_data<span class="sc">$</span>your_variable)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare histograms </span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(your_clean_data<span class="sc">$</span>your_variable, </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram: Your variable name - original clean data"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(your_anonymous_data<span class="sc">$</span>your_variable, </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram: Your variable name - anonymous data"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare density distribution</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(your_clean_data<span class="sc">$</span>your_variable), </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(x, x), <span class="at">ylim =</span> <span class="fu">c</span>(x, x), </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Density"</span>, <span class="at">xlab =</span> <span class="st">"Your variable"</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span> (<span class="at">new =</span> <span class="cn">TRUE</span>) <span class="co"># adds the second graph on top</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(your_anonymous_data<span class="sc">$</span>your_variable), </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(x, x), <span class="at">ylim =</span> <span class="fu">c</span>(x, x), </span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Density"</span>, <span class="at">xlab =</span> <span class="st">"Your variable name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
<section id="difference-of-means-test" class="level5" data-number="4.2.6.2.2">
<h5 data-number="4.2.6.2.2" class="anchored" data-anchor-id="difference-of-means-test"><span class="header-section-number">4.2.6.2.2</span> Difference of means test</h5>
<p>A difference of means test is useful for comparing the significance of the difference of the mean of two continuous variables.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dif_means <span class="ot">&lt;-</span> <span class="fu">t.test</span>(your_clean_data<span class="sc">$</span>your_variable, your_anonymous_data<span class="sc">$</span>your_variable, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>dif_means <span class="co">#print the result</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#If the p-value is above the threshold chosen for statistical significance (usually 0.10, 0.05, or 0.01 level), then the difference between the means not statistically significant. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The following example compares the total number of household members in the clean version (<code>dat_clean</code>) of the dataset and anonymized version (<code>dat_anon</code>). The household size was topcoded as part of the anonymization process. The results of the t-test demonstrate that the difference in mean is not statistically significant. In summary, the p-value should be greater than 0.10 or 0.05 to establish that the difference between the clean and anonymous version of the variable is not statistically significant and the utility has been preserved.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="section4_2_6_2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5varrelationships" class="level4" data-number="4.2.6.3">
<h4 data-number="4.2.6.3" class="anchored" data-anchor-id="sec-5varrelationships"><span class="header-section-number">4.2.6.3</span> Variable relationships</h4>
<section id="fitted-models" class="level5" data-number="4.2.6.3.1">
<h5 data-number="4.2.6.3.1" class="anchored" data-anchor-id="fitted-models"><span class="header-section-number">4.2.6.3.1</span> Fitted models</h5>
<p>Regression parameters of the same regression done on the clean and anonymous versions of the dataset can be done verify if the change was statistically significant. The choice of the regression formula depends on the type of dataset and the relationships between variables. For example, a regression could be used to explain earnings as a function of education and experience. If the new estimated coefficients fall within the original confidence interval, the data can be considered valid for this type of regression after anonymization.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the variables to use in the regression</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dependent_var <span class="ot">&lt;-</span> <span class="st">"your_dependent_variable"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>independent_var1 <span class="ot">&lt;-</span> <span class="st">"your_independent_variable_1"</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>independent_var2 <span class="ot">&lt;-</span> <span class="st">"your_independent_variable_2"</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>independent_var3 <span class="ot">&lt;-</span> <span class="st">"your_independent_variable_3"</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the weight variable</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>weight_var <span class="ot">&lt;-</span> <span class="st">"your_weight_variable"</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the regression formula</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>independent_vars_formula <span class="ot">&lt;-</span> <span class="fu">paste</span>(independent_var1, independent_var2,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                            independent_var3, <span class="at">sep =</span> <span class="st">"+"</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>regression_formula <span class="ot">&lt;-</span> <span class="fu">paste</span>(dependent_var, independent_vars_formula, <span class="at">sep =</span> <span class="st">"~"</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: the formula will be: </span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#          your_dependent_variable ~ your_independent_variable_1 +</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#          your_independent_variable_2 + your_independent_variable_3</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate the regression of the original data</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>regression_clean_dataset <span class="ot">&lt;-</span> <span class="fu">lm</span>(regression_formula,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                               your_clean_data,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.action =</span> na.exclude,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">weights =</span> your_clean_data[[weight_var]])</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate the regression of the anonymous data</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>regression_anonymous_dataset <span class="ot">&lt;-</span> <span class="fu">lm</span>(regression_formula,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>                               your_anonymous_data,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.action =</span> na.exclude,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">weights =</span> your_anonymous_data[[weight_var]])</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the 95% CI for the clean dataset</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(<span class="at">obj =</span> regression_clean_dataset, <span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="co"># this will print something like this:</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                              2.5 %    97.5 %</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="co"># (Intercept)                 1.0951    1.1437</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="co"># your_independent_variable_1      -1.9614   -1.5778</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="co"># your_independent_variable_2       3.3923    4.2352</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="co"># your_independent_variable_3       2.5120    3.3995</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the coefficients for the anonymized dataset</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>regression_anonymous_dataset<span class="sc">$</span>coefficients</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="co"># this will print something like this:</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="co">#         (Intercept)          your_independent_variable_1 </span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="co">#              1.1074                        -1.7676</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="co">#     your_independent_variable_2    your_independent_variable_3 </span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="co">#                    3.6787                   2.8088 </span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="co">#As the coefficients fall within the confidence interval for all three variables (from the original dataset), the relationship between variables is maintained after the anonymization. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5weights-to-analysis" class="level4" data-number="4.2.6.4">
<h4 data-number="4.2.6.4" class="anchored" data-anchor-id="sec-5weights-to-analysis"><span class="header-section-number">4.2.6.4</span> Applying survey weights to analysis</h4>
<p>In cases of disproportionately stratified datasets, weights must be applied to analysis that spans across strata. The <code>survey</code> package can be used to apply the weights and run simple statistics.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Once the survey package is installed and loaded, the following can be used to create a new data frame your_dataset_survey that applies the survey weights (variable survey_weight) based on your_strata variable.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create survey</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>your_dataset_survey <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span><span class="dv">0</span>, </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weights=</span><span class="sc">~</span>survey_weight,<span class="at">strata=</span><span class="sc">~</span>your_strat,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">survey.lonely.psu=</span><span class="st">"adjust"</span>,<span class="at">data=</span>your_dataset)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Now you can use your_dataset_survey to calculate the statistics needed. Note that it is more useful to compare proportions produced by the results as opposed to summaries because the summaries will be estimates for the entire population of interest in the sample frame not just within the sample</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
</section>
</section>
<section id="sec-5saveanon" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="sec-5saveanon"><span class="header-section-number">4.2.7</span> Save anonymous version, codebook and anonymization script</h3>
<p>Data should be saved at least as a csv for publication on the MDL. If the raw/clean version were provided as a <code>dta</code> (stata) or <code>sav</code> (spss) that preserves additional details such as variable and value labels it should also be saved in those formats.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The following uses the haven package, so make sure it is installed and loaded before running the code below</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(your_anonymous_data, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"0_data/anonymous/your_anonymous_data.xlsx"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheetName=</span><span class="st">"data"</span>,<span class="at">row.names=</span><span class="cn">FALSE</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Export xlsx</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(your_anonymous_data, <span class="st">"0_data/anonymous/your_anonymous_data.xlsx"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Export dta</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">write_dta</span>(your_anonymous_data, <span class="st">"0_data/anonymous/your_anonymous_data.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For datasets with encoded values (responses), it can be very helpful for the Data Users to have a codebook that can be shared with the dataset. The example below demonstrates how to create a simple codebook. Note that this assumes that labels have already been created for the variables and values (see previous section).</p>
<p><em>Creating a codebook in R</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable names and labels</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>your_dataset_var_codebook <span class="ot">&lt;-</span> your_dataset <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_label</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"Code"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="st">"Label"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Label)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  value names and labels</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>your_dataset_val_codebook <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">select_if</span>(your_dataset, is.labelled), <span class="cf">function</span>(col) {</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">tibble</span>(<span class="at">values =</span> <span class="fu">as.character</span>(col),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">to_factor</span>(col))))}) <span class="sc">%&gt;%</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>()</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># export codebook to excel with a tab for variables and a tab for values</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(<span class="fu">list</span>(<span class="at">variables=</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>                  your_dataset_var_codebook,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">values=</span>your_dataset_val_codebook), </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">"your_dataset_name_codebook.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, the anonymization script and workspace (<code>.R</code>) should be saved to be stored with the rest of the curation files on the GDS SharePoint space. These files should not be shared on RIDL. The anonymization script can be saved using the R studio interface. The workspace can be saved using the example code below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#save the workspace</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file =</span> <span class="st">"1_scripts/your_anonymization_workspace.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>&nbsp;<a href="https://statsandr.com/blog/data-types-in-r/" class="uri">https://statsandr.com/blog/data-types-in-r/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>&nbsp;&nbsp;<a href="https://en.wikipedia.org/wiki/ISO_8601" class="uri">https://en.wikipedia.org/wiki/ISO_8601</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In some cases, a 0 is used in place of a blank value. It needs to be determined if this is a true value of 0 or a blank value. 0 should only be used for a 0 value.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Note that the anonymous version (next section) and the raw/clean versions will certainly have slight differences when manipulations are made as part of the anonymization process. This can be explained in the metadata. The point here is that the data shared by the Data Provider (the base used prior to anonymization) should at least be consistent with any published works).<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Key variables, also called “quasi-identifiers”, are a set of variables that, in combination, can be linked to external information to re-identify respondents in a dataset<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>From the <a href="https://sdcpractice.readthedocs.io/en/latest/measure_risk.html">SDC Practice Guide</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./indentify_data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Identify data for publication</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./drr.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Disclosure risk assessment</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>